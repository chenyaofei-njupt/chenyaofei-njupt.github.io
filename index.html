<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="yfchen&#39;s blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="yfchen&#39;s blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="yfchen&#39;s blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>yfchen's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">yfchen's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br />
            
            Schedule
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/17/Cloudera安装Spark2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yfchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yfchen's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/17/Cloudera安装Spark2/" itemprop="url">Cloudera安装Spark2.0</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-17T19:09:33+08:00">
                2018-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Cloudera-Spark-安装要求"><a href="#Cloudera-Spark-安装要求" class="headerlink" title="Cloudera Spark 安装要求"></a>Cloudera Spark 安装要求</h2><ul>
<li>CDH 版本</li>
<li>Cloudera Manager 版本</li>
<li>Scala 2.11 必须</li>
<li>Python 必须</li>
<li>JDK8 必须</li>
</ul>
<h3 id="CDH-版本"><a href="#CDH-版本" class="headerlink" title="CDH 版本"></a>CDH 版本</h3><table>
<thead>
<tr>
<th>CDS  Powered By Apache Spark Version</th>
<th>CDH版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>2.3 Release2</td>
<td>CDH 5.9 和任何高于  CDH 5.x 版本</td>
</tr>
</tbody>
</table>
<p>这里只安装CDS 2.3, 集群中的CDH是5.13版本的,是可以安装 CDS2.3 的</p>
<h3 id="Cloudera-Manager-版本"><a href="#Cloudera-Manager-版本" class="headerlink" title="Cloudera Manager 版本"></a>Cloudera Manager 版本</h3><table>
<thead>
<tr>
<th>CDS  Powered By Apache Spark Version</th>
<th>Cloudera Manager版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>2.3 Release2</td>
<td>Cloudera Manager 5.11 和高于5.11 的版本</td>
</tr>
</tbody>
</table>
<p>这里只安装CDS 2.3, 集群中的Cloudera Manager是5.12版本 的,是可以安装 CDS2.3 的</p>
<h3 id="Scala-2-11-必须"><a href="#Scala-2-11-必须" class="headerlink" title="Scala 2.11 必须"></a>Scala 2.11 必须</h3><p>Spark2 不能和Scala2.10版本一起用,只能使用2.11版本</p>
<p>集群中只有23有Scala (还是我跑单机spark装的,版本是2.12.5,卸载重新装), 21和24两台机器都没有Scala2.11</p>
<h5 id="以下操作三台机器都要进行"><a href="#以下操作三台机器都要进行" class="headerlink" title="以下操作三台机器都要进行"></a>以下操作三台机器都要进行</h5><p>下载<strong>Scala2.11</strong></p>
<p>地址: <a href="https://www.scala-lang.org/download/2.11.12.html" target="_blank" rel="noopener">https://www.scala-lang.org/download/2.11.12.html</a></p>
<p>解压到 /usr/local/share</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -xzvf scala-2.11.12.tgz -C /usr/local/share</span><br></pre></td></tr></table></figure>
<p>配置scala环境变量</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure>
<p>添加下面两行到profile 文件的末尾</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export SCALA_HOME=/usr/local/share/scala-<span class="number">2.11</span>.<span class="number">12</span></span><br><span class="line">export PATH=$SCALA_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>
<p>更新并保存profile文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>
<h3 id="JDK8-必须"><a href="#JDK8-必须" class="headerlink" title="JDK8 必须"></a>JDK8 必须</h3><p>集群中Java版本是1.8.0_161,满足条件</p>
<h3 id="在必备依赖都安装好之后-就可以开始安装CDS了"><a href="#在必备依赖都安装好之后-就可以开始安装CDS了" class="headerlink" title="在必备依赖都安装好之后,就可以开始安装CDS了"></a>在必备依赖都安装好之后,就可以开始安装CDS了</h3><p>在安装之前先把之前没有安装成功的spark2清理干净</p>
<ul>
<li><p>下载 CDS Powered By Apache Spark</p>
<p>地址: <a href="https://www.cloudera.com/documentation/spark2/latest/topics/spark2_packaging.html#versions" target="_blank" rel="noopener">https://www.cloudera.com/documentation/spark2/latest/topics/spark2_packaging.html#versions</a></p>
<p>​    选择 <strong>SPARK2_ON_YARN-2.3.0.cloudera2.jar</strong></p>
</li>
<li><p>把下载的文件放到 <strong>/opt/cloudera/csd</strong> 目录下面</p>
<p>然后修改文件的用户和组:</p>
<ul>
<li>chgrp cloudera-scm SPARK2_ON_YARN-2.3.0.cloudera2.jar</li>
<li>chown cloudera-scm SPARK2_ON_YARN-2.3.0.cloudera2.jar</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[admin@node24 csd]$ ll</span><br><span class="line">total 20</span><br><span class="line">-rw-r--r-- 1 cloudera-scm cloudera-scm 19010 Apr 25 02:16 SPARK2_ON_YARN-2.3.0.cloudera2.jar</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>重启Cloudera</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service cloudera-scm-server restart</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入Cloudera Manager 的Parcel界面</p>
</li>
</ul>
<ul>
<li><p>下载SPARK2的远程parcel, 下载好之后 ,同样的地方点击<strong>分配</strong>,之后点击<strong>激活</strong></p>
</li>
<li><p>添加<strong>SPARK2</strong> 到集群中</p>
<p>​    <img src="/2018/05/17/Cloudera安装Spark2/images/1524991897(1" alt="1524991897(1)">.png)</p>
<p>​    点击Cloudera首页中Cluster1下拉箭头,选择添加服务</p>
<p>添加过程中会报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“客户端配置 (id=2) 已使用 1 退出,而预期值为 0</span><br></pre></td></tr></table></figure>
<p>查看日志是java版本问题</p>
<p><img src="/2018/05/17/Cloudera安装Spark2/images/1524992785(1" alt="1524992785(1)">.png)</p>
<p>​</p>
<p>解决方法:</p>
<p>​    进入Cloudera Manager中的每个主机中, 点击 配置 -&gt;高级, 配置JAVA_HOME :/usr/java/jdk1.8.0_161</p>
<p>​    保存更改,注意每台机器都要配置,重启cloudera服务</p>
<p><img src="/2018/05/17/Cloudera安装Spark2/images/1524992984(1" alt="1524992984(1)">.png)</p>
<p>​</p>
<ol>
<li><p>选择依赖</p>
<p>a. HDFS, YARN, ZooKeeper: 如果不需要Hive服务就选择这个</p>
<p>b. HDFS, Hive, YARN, ZooKeeper: 需要Hive服务就选择这个</p>
<p><strong>我们就选择b有hive的</strong></p>
</li>
<li><p>给每个主机添加gateway 角色</p>
</li>
<li><p>注意history server是18089,而不是18088了</p>
</li>
<li><p>完成添加spark2 服务</p>
</li>
</ol>
</li>
<li><p>重启cloudera服务</p>
<p>spark2添加完成</p>
</li>
</ul>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><ol>
<li><p>cloudera的java版本较低,添加spark2服务失败</p>
<p>解决方法前面已经给出</p>
</li>
<li><p>添加服务完成后, 21和24运行spark2-shell可以使用spark2</p>
<p>​</p>
<p>23这台机器运行spark2-shell 出来的却是spark1.6.1</p>
<p>应该是很早之前安装的时候,配置有问题,把spark2-shell 配置成了spark1.6的版本, </p>
<p>解决方法:</p>
<p>​    我先把spark2的文件全部删除了, 包括</p>
<p>​        /etc/spark2</p>
<p>​        /opt/cloudera/parcels/SPARK2-2.3.0.cloudera2-1.cdh5.13.3.p0.316101</p>
<pre><code>/opt/cloudera/parcels/SPARK2
</code></pre><p>​       运行spark2-shell依然出现 spark1.6, 正常情况应该是找不发哦spark2-shell这个命令的.</p>
<p>​    我就搜索有spark2-shell的路径,发现有如下路径,然后我把这里面的spark2-shell spark2-submit和         pyspark2全部删除, 再运行spark2-shell就显示找不到命令了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[admin@master spark]$ sudo find / -name spark2-shell</span><br><span class="line">/etc/alternatives/spark2-shell</span><br><span class="line">/var/lib/alternatives/spark2-shell</span><br><span class="line">/usr/bin/spark2-shell</span><br></pre></td></tr></table></figure>
<p>​    删除所有机器上的spark2 文件,重新安装</p>
<p>最终,23还是spark1.6版本, 21和24是spark2.3</p>
</li>
</ol>
<p>参考:</p>
<p><a href="https://www.cloudera.com/documentation/spark2/latest/topics/spark2_installing.html" target="_blank" rel="noopener">https://www.cloudera.com/documentation/spark2/latest/topics/spark2_installing.html</a></p>
<p><a href="https://www.cloudera.com/documentation/enterprise/latest/topics/cm_ig_parcels.html#cmug_topic_7_11_5__section_sd4_bzx_bm" target="_blank" rel="noopener">https://www.cloudera.com/documentation/enterprise/latest/topics/cm_ig_parcels.html#cmug_topic_7_11_5__section_sd4_bzx_bm</a></p>
<p><a href="https://www.cloudera.com/documentation/enterprise/latest/topics/cm_mc_addon_services.html#concept_kpt_spj_bn" target="_blank" rel="noopener">https://www.cloudera.com/documentation/enterprise/latest/topics/cm_mc_addon_services.html#concept_kpt_spj_bn</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/25/Spark-on-Yarn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yfchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yfchen's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/25/Spark-on-Yarn/" itemprop="url">Spark on Yarn</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-25T19:29:48+08:00">
                2018-04-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spark-on-Yarn"><a href="#Spark-on-Yarn" class="headerlink" title="Spark on Yarn"></a>Spark on Yarn</h1><h5 id="使用Spark-on-Yarn有两种方式-一种是使用pyspark-另外一种是使用spark-submit"><a href="#使用Spark-on-Yarn有两种方式-一种是使用pyspark-另外一种是使用spark-submit" class="headerlink" title="使用Spark on Yarn有两种方式,一种是使用pyspark,另外一种是使用spark-submit"></a>使用Spark on Yarn有两种方式,一种是使用pyspark,另外一种是使用spark-submit</h5><h3 id="spark-submit"><a href="#spark-submit" class="headerlink" title="spark-submit"></a>spark-submit</h3><p>使用spark-submit –help查看帮助</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark-submit --help</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>options</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>–master</strong> MASTER_URL</td>
<td>可以选spark://host:port, mesos://host:port, yarn, 或 local. 我们使用的集群是建立在yarn之上的, 一般我们选yarn</td>
</tr>
<tr>
<td><strong>–deploy-mode</strong> DEPLOY_MODE</td>
<td>部署driver在本地还是集群的一个work节点上，这也是client模式与cluster模式的区别。默认是client的模式</td>
</tr>
<tr>
<td><strong>–class</strong> CLASS_NAME</td>
<td>应用的主类(用于java和scala的apps)</td>
</tr>
<tr>
<td><strong>–name</strong> NAME</td>
<td>应用的名称</td>
</tr>
<tr>
<td><strong>–py-files</strong> PY_FILES</td>
<td>运行的python文件,可以是.zip, .egg, .py 文件</td>
</tr>
<tr>
<td><strong>-conf</strong> PROP=VALUE</td>
<td>指定的spark 配置</td>
</tr>
<tr>
<td><strong>–driver-memory</strong> MEM</td>
<td>指定drive-memory, 默认大小是1024M</td>
</tr>
<tr>
<td><strong>–executor-memory</strong></td>
<td>指定executor-memory,默认大小是1024M</td>
</tr>
<tr>
<td><strong>–verbose, -v</strong></td>
<td>打印额外的debug输出</td>
</tr>
<tr>
<td><strong>–driver-cores</strong> NUM</td>
<td>driver使用的核的数量,仅在cluster下可以使用,默认是1个.</td>
</tr>
<tr>
<td><strong>–num-executors</strong> NUM</td>
<td>指定executor的数量,默认是2</td>
</tr>
</tbody>
</table>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spark-submit \</span><br><span class="line">  --class &lt;main-class&gt; \</span><br><span class="line">  --master &lt;master-url&gt; \</span><br><span class="line">  --deploy-mode &lt;deploy-mode&gt; \</span><br><span class="line">  --conf &lt;key&gt;=&lt;value&gt; \</span><br><span class="line">  ... # other options</span><br><span class="line">  &lt;application-jar&gt; \</span><br><span class="line">  [application-arguments]</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">spark-submit \</span><br><span class="line">	--master yarn \</span><br><span class="line">    --num-executors 100 \</span><br><span class="line">    --executor-memory 6G \</span><br><span class="line">    --executor-cores 4 \</span><br><span class="line">    --driver-memory 1G \ </span><br><span class="line">    --conf spark.default.parallelism=1000  \</span><br><span class="line">    --conf spark.storage.memoryFraction=0.5 \</span><br><span class="line">    --conf spark.shuffle.memoryFraction=0.3 </span><br><span class="line">    test.py</span><br></pre></td></tr></table></figure>
<p><strong>注:</strong>  我使用上面的命令 –py-files test.py 时报错如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Error: Must specify a primary resource (JAR or Python or R file)</span><br><span class="line">Run with --help for usage help or --verbose for debug output</span><br></pre></td></tr></table></figure>
<p>而把–py-files删除,就能正常跑了</p>
<h3 id="pyspark"><a href="#pyspark" class="headerlink" title="pyspark"></a>pyspark</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pyspark \</span><br><span class="line">	--master yarn \</span><br><span class="line">    --num-executors 100 \</span><br><span class="line">    --executor-memory 6G \</span><br><span class="line">    --executor-cores 4 \</span><br><span class="line">    --driver-memory 1G \ </span><br><span class="line">    --conf spark.default.parallelism=1000  \</span><br><span class="line">    --conf spark.storage.memoryFraction=0.5 \</span><br><span class="line">    --conf spark.shuffle.memoryFraction=0.3</span><br></pre></td></tr></table></figure>
<p>pyspark与spark-submit的不同之处在于,pyspark需要进入python程序,需要一行一行的输入代码,而spark-submit则可以运行整个脚本,或者有多个python文件打包的zip, 相比直线spark-submit更方便一些.</p>
<p>在提交了Spark应用之后可以进入Spark Web UI查看运行的基本情况.</p>
<p>使用机器的时候不要使用23 这台机器,可以使用21,具体的spark调优参考之前写的那个spark调优文档.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/23/Spark入门文档/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yfchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yfchen's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/23/Spark入门文档/" itemprop="url">Spark入门文档</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-23T19:14:15+08:00">
                2018-04-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="Spark操作数据类型"><a href="#Spark操作数据类型" class="headerlink" title="Spark操作数据类型"></a>Spark操作数据类型</h4><ul>
<li>RDD (Resilient Distributed Datasets, 弹性分布式数据集</li>
<li>DataFrame</li>
<li>Dataset</li>
</ul>
<h4 id="pyspark启动-–-使用shell"><a href="#pyspark启动-–-使用shell" class="headerlink" title="pyspark启动 – 使用shell"></a>pyspark启动 – 使用shell</h4><ol>
<li><p>默认使用python</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> ./bin/pyspark --master local[4]</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span>./bin/pyspark --master local[4] --py-files code.py</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用Ipython</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> PYSPARK_DRIVER_PYTHON=ipython ./bin/pyspark</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用Jupyter notebook</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> PYSPARK_DRIVER_PYTHON=jupyter PYSPARK_DRIVER_PYTHON_OPTS=notebook ./bin/pyspark</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="RDD操作"><a href="#RDD操作" class="headerlink" title="RDD操作"></a>RDD操作</h4><p>​    <strong>RDD</strong>支持两种操作, <strong>transformations</strong>和<strong>actions</strong></p>
<p>​    <strong>transformations</strong>操作是指: 根据已有的dataset创建新的dataset</p>
<p>​    <strong>actions</strong>操作是指: 在运行完dataset上的计算操作后,返回到驱动程序一个值</p>
<p>​    所有<strong>Spark</strong>的<strong>transformations</strong>操作都是懒惰的,他们并不是立刻计算结果,而是在执行<strong>actions</strong>操作的时执行.</p>
<p>​    这种设计使得<strong>Spark</strong>的运行更加有效率</p>
<h4 id="打印RDD中的元素"><a href="#打印RDD中的元素" class="headerlink" title="打印RDD中的元素"></a>打印RDD中的元素</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打印所有的</span></span><br><span class="line">rdd.collect().foreah(println)</span><br><span class="line"><span class="comment"># 打印100个</span></span><br><span class="line">rdd.take(<span class="number">100</span>).foreach(println)</span><br></pre></td></tr></table></figure>
<h4 id="Transformations"><a href="#Transformations" class="headerlink" title="Transformations"></a>Transformations</h4><table>
<thead>
<tr>
<th><strong>Transfromations</strong></th>
<th><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>map</strong>(<em>func</em>)</td>
<td>返回一个新的分布式数据集，将数据源的每一个元素传递给函数 <em>func</em>映射组成.</td>
</tr>
<tr>
<td><strong>filter</strong>(<em>func</em>)</td>
<td>返回一个新的数据集，从数据源中选中一些元素通过函数 <em>func</em> 返回 true.</td>
</tr>
<tr>
<td><strong>flatMap</strong>(<em>func</em>)</td>
<td>类似于 map，但是每个输入项能被映射成多个输出项(所以 <em>func</em> 必须返回一个 Seq，而不是单个 item)。</td>
</tr>
<tr>
<td><strong>mapPartitions</strong>(<em>func</em>)</td>
<td>类似于 map，但是分别运行在 RDD 的每个分区上，所以 <em>func</em> 的类型必须是 <code>Iterator&lt;T&gt; =&gt; Iterator&lt;U&gt;</code> 当运行在类型为 T 的 RDD 上。</td>
</tr>
<tr>
<td><strong>mapPartitionsWithIndex</strong>(<em>func</em>)</td>
<td>类似于 mapPartitions，但是 <em>func</em> 需要提供一个 integer 值描述索引(index)，所以 <em>func</em> 的类型必须是 (Int, Iterator) =&gt; Iterator 当运行在类型为 T 的 RDD 上。</td>
</tr>
<tr>
<td><strong>sample</strong>(<em>withReplacement</em>, <em>fraction</em>, <em>seed</em>)</td>
<td>根据给定的随机种子seed，随机抽样出数量为frac的数据</td>
</tr>
<tr>
<td><strong>union</strong>(otherDataset)</td>
<td>返回一个新的数据集，由原数据集和参数联合而成</td>
</tr>
<tr>
<td><strong>groupByKey</strong>([numTasks])</td>
<td>在一个由（K,V）对组成的数据集上调用，返回一个（K，Seq[V])对的数据集。注意：默认情况下，使用8个并行任务进行分组，你可以传入numTask可选参数，根据数据量设置不同数目的Task</td>
</tr>
<tr>
<td><strong>reduceByKey</strong>(func, [numTasks])</td>
<td>在一个（K，V)对的数据集上使用，返回一个（K，V）对的数据集，key相同的值，都被使用指定的reduce函数聚合到一起。和groupbykey类似，任务的个数是可以通过第二个可选参数来配置的。</td>
</tr>
<tr>
<td><strong>join</strong>(otherDataset, [numTasks])</td>
<td>在类型为（K,V)和（K,W)类型的数据集上调用，返回一个（K,(V,W))对，每个key中的所有元素都在一起的数据集</td>
</tr>
<tr>
<td><strong>groupWith</strong>(otherDataset, [numTasks])</td>
<td>在类型为（K,V)和(K,W)类型的数据集上调用，返回一个数据集，组成元素为（K, Seq[V], Seq[W]) Tuples。这个操作在其它框架，称为CoGroup</td>
</tr>
<tr>
<td><strong>cartesian</strong>(otherDataset)</td>
<td>笛卡尔积。但在数据集T和U上调用时，返回一个(T，U）对的数据集，所有元素交互进行笛卡尔积。</td>
</tr>
<tr>
<td><strong>coalesce</strong>(<em>numPartitions</em>)</td>
<td>增加RDD的分区,使得操作更加有效率,不改变数据的顺序</td>
</tr>
<tr>
<td><strong>repartition</strong>(<em>numPartitions</em>)</td>
<td>改变RDD的分区数量,会改变数据的顺序</td>
</tr>
<tr>
<td><strong>repartitionAndSortWithinPartitions</strong>(<em>partitioner</em>)</td>
<td>对RDD重新分区,并且对分区后的每一个分区按照key进行排序,这比只用repartition有效率</td>
</tr>
<tr>
<td><strong>intersection</strong>(<em>otherDataset</em>)</td>
<td>返回两个RDD的交集,结果中无重复元素</td>
</tr>
<tr>
<td><strong>distinct</strong>([<em>numPartitions</em>]))</td>
<td>返回一个新的数据集,只包含原始数据集的唯一元素</td>
</tr>
</tbody>
</table>
<h4 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h4><p><strong>map</strong>(<em>func</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd = sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd.map(<span class="keyword">lambda</span> x: x*x).collect()</span><br><span class="line">[<span class="number">1</span>,<span class="number">4</span>,<span class="number">9</span>]</span><br></pre></td></tr></table></figure>
<p><strong>filter</strong>(<em>func</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd = sc.parallelize([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd.filter(<span class="keyword">lambda</span> x: x &gt; <span class="number">2</span>).collect()</span><br><span class="line">[<span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<p><strong>flatMap</strong>(<em>func</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># map 与flatMap的区别</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd = sc.parallelize([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd.map(<span class="keyword">lambda</span> x: range(<span class="number">1</span>, x)).collect()</span><br><span class="line">[[], [<span class="number">1</span>], [<span class="number">1</span>, <span class="number">2</span>]]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd = sc.parallelize([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd.flatMap(<span class="keyword">lambda</span> x: range(<span class="number">1</span>, x))</span><br><span class="line">[<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<p> <strong>mapPartitions</strong>(<em>func</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd = sc.parallelize([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>], <span class="number">2</span>)</span><br><span class="line">// 两个分区的数据分别为 [<span class="number">1</span>,<span class="number">2</span>] [<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span> <span class="keyword">yield</span> sum(x)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd.mapPartitions(f).collect()</span><br><span class="line">[<span class="number">3</span>, <span class="number">7</span>]</span><br></pre></td></tr></table></figure>
<p> <strong>mapPartitionsWithIndex</strong>(<em>func</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd = sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(splitIndex, iterator)</span>:</span> <span class="keyword">yield</span> splitIndex</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd.mapPartitionsWithIndex(f).sum()</span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>
<p><strong>mapValues</strong>(<em>f</em>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 遍历RDD键值对中的的每一个值,不改变键的前提下,使用map中的函数,这个操作依旧保持着原来的分区</span><br><span class="line">&gt;&gt;&gt; x = sc.parallelize([(&quot;a&quot;, [&quot;apple&quot;, &quot;banana&quot;, &quot;lemon&quot;]), (&quot;b&quot;, [&quot;grapes&quot;])])</span><br><span class="line">&gt;&gt;&gt; def f(x): return len(x)</span><br><span class="line">&gt;&gt;&gt; x.mapValues(f).collect()</span><br><span class="line">[(&apos;a&apos;, 3), (&apos;b&apos;, 1)]</span><br></pre></td></tr></table></figure>
<p><strong>sample</strong>(<em>withReplacement</em>, <em>fraction</em>, <em>seed</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回这个RDD的一个子集</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd = sc.parallelize(range(<span class="number">100</span>), <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd.sample(<span class="keyword">False</span>, <span class="number">0.1</span>, <span class="number">81</span>).count()</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure>
<p> <strong>union</strong>(otherDataset)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#返回一个新的数据集，由原数据集和参数联合而成</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd = sc.parallelize([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd.union(rdd).collect()</span><br><span class="line">[<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<p><strong>intersection</strong>(<em>otherDataset</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回两个RDD的交集,结果中无重复元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd1 = sc.parallelize([<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd2 = sc.parallelize([<span class="number">1</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">8</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd1.intersection(rdd2).collect()</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<p><strong>distinct</strong>([<em>numPartitions</em>]))</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回一个新的数据集,只包含原始数据集的唯一元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(sc.parallelize([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]).distinct().collect())</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<p> <strong>groupByKey</strong>([numTasks])</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; rdd = sc.parallelize([(&quot;a&quot;, 1), (&quot;b&quot;, 1), (&quot;a&quot;, 1)])</span><br><span class="line">&gt;&gt;&gt; sorted(rdd.groupByKey().mapValues(len).collect())</span><br><span class="line">[(&apos;a&apos;, 2), (&apos;b&apos;, 1)]</span><br><span class="line">&gt;&gt;&gt; sorted(rdd.groupByKey().mapValues(list).collect())</span><br><span class="line">[(&apos;a&apos;, [1, 1]), (&apos;b&apos;, [1])]</span><br></pre></td></tr></table></figure>
<p><strong>reduceByKey</strong>(func, [numTasks]) </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> operator <span class="keyword">import</span> add</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd = sc.parallelize([(<span class="string">"a"</span>, <span class="number">1</span>), (<span class="string">"b"</span>, <span class="number">1</span>), (<span class="string">"a"</span>, <span class="number">1</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(rdd.reduceByKey(add).collect())</span><br><span class="line">[(<span class="string">'a'</span>, <span class="number">2</span>), (<span class="string">'b'</span>, <span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 和groupByKey的比较</span></span><br><span class="line"><span class="comment"># groupByKey</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> operator <span class="keyword">import</span> add</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd = sc.parallelize([(<span class="string">"a"</span>, <span class="number">1</span>), (<span class="string">"b"</span>, <span class="number">1</span>), (<span class="string">"a"</span>, <span class="number">1</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(rdd.groupByKey().mapValues(sum).collect())</span><br><span class="line">[(<span class="string">'a'</span>, <span class="number">2</span>), (<span class="string">'b'</span>, <span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment">#redeuceByKey直接按key进行函数操作,而groupByKey需要group之后再mapValue操作</span></span><br></pre></td></tr></table></figure>
<p><strong>join</strong>(<em>otherDataset</em>, [<em>numPartitions</em>])</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在类型为（K,V)和（K,W)类型的数据集上调用，返回一个（K,(V,W))对，每个key中的所有元素都在一起的数据集</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = sc.parallelize([(<span class="string">"a"</span>, <span class="number">1</span>), (<span class="string">"b"</span>, <span class="number">4</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = sc.parallelize([(<span class="string">"a"</span>, <span class="number">2</span>), (<span class="string">"a"</span>, <span class="number">3</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(x.join(y).collect())</span><br><span class="line">[(<span class="string">'a'</span>, (<span class="number">1</span>, <span class="number">2</span>)), (<span class="string">'a'</span>, (<span class="number">1</span>, <span class="number">3</span>))]</span><br></pre></td></tr></table></figure>
<p><strong>groupWith</strong>(<em>other</em>, <strong>others</strong>)   <strong>A.K.A</strong>  <strong>cogroup</strong>(<em>otherDataset</em>, [<em>numPartitions</em>]) </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>w = sc.parallelize([(<span class="string">"a"</span>, <span class="number">5</span>), (<span class="string">"b"</span>, <span class="number">6</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = sc.parallelize([(<span class="string">"a"</span>, <span class="number">1</span>), (<span class="string">"b"</span>, <span class="number">4</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = sc.parallelize([(<span class="string">"a"</span>, <span class="number">2</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>z = sc.parallelize([(<span class="string">"b"</span>, <span class="number">42</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[(x, tuple(map(list, y))) <span class="keyword">for</span> x, y <span class="keyword">in</span> sorted(list(w.groupWith(x, y, z).collect()))]</span><br><span class="line">[(<span class="string">'a'</span>, ([<span class="number">5</span>], [<span class="number">1</span>], [<span class="number">2</span>], [])), (<span class="string">'b'</span>, ([<span class="number">6</span>], [<span class="number">4</span>], [], [<span class="number">42</span>]))]</span><br></pre></td></tr></table></figure>
<p><strong>cartesian</strong>(<em>otherDataset</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回两个RDD的笛卡尔积</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd = sc.parallelize([<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(rdd.cartesian(rdd).collect())</span><br><span class="line">[(<span class="number">1</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">2</span>), (<span class="number">2</span>, <span class="number">1</span>), (<span class="number">2</span>, <span class="number">2</span>)]</span><br></pre></td></tr></table></figure>
<p><strong>coalesce</strong>(<em>numPartitions</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据指定的分区数目返回新的RDD, 但不改变数据的顺序</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], <span class="number">3</span>).glom().collect()</span><br><span class="line">[[<span class="number">1</span>], [<span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], <span class="number">3</span>).coalesce(<span class="number">1</span>).glom().collect()</span><br><span class="line">[[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]]</span><br></pre></td></tr></table></figure>
<p><strong>repartition</strong>(<em>numPartitions</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据指定的分区数目返回新的RDD, 会改变数据的顺序</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd = sc.parallelize([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>], <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(rdd.glom().collect())</span><br><span class="line">[[<span class="number">1</span>], [<span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>], [<span class="number">6</span>, <span class="number">7</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>len(rdd.repartition(<span class="number">2</span>).glom().collect())</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>len(rdd.repartition(<span class="number">10</span>).glom().collect())</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure>
<p><strong>repartitionAndSortWithinPartitions</strong>(<em>partitioner</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对RDD重新分区,并且对分区后的每一个分区按照key进行排序,这比只用repartition有效率</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd = sc.parallelize([(<span class="number">0</span>, <span class="number">5</span>), (<span class="number">3</span>, <span class="number">8</span>), (<span class="number">2</span>, <span class="number">6</span>), (<span class="number">0</span>, <span class="number">8</span>), (<span class="number">3</span>, <span class="number">8</span>), (<span class="number">1</span>, <span class="number">3</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd2 = rdd.repartitionAndSortWithinPartitions(<span class="number">2</span>, <span class="keyword">lambda</span> x: x % <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd2.glom().collect()</span><br><span class="line">[[(<span class="number">0</span>, <span class="number">5</span>), (<span class="number">0</span>, <span class="number">8</span>), (<span class="number">2</span>, <span class="number">6</span>)], [(<span class="number">1</span>, <span class="number">3</span>), (<span class="number">3</span>, <span class="number">8</span>), (<span class="number">3</span>, <span class="number">8</span>)]]</span><br></pre></td></tr></table></figure>
<h4 id="Aciton"><a href="#Aciton" class="headerlink" title="Aciton"></a>Aciton</h4><table>
<thead>
<tr>
<th><strong>Action</strong></th>
<th><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>reduce</strong>(<em>func</em>)</td>
<td>通过函数func聚集数据集中的所有元素。Func函数接受2个参数，返回一个值。这个函数必须是关联性的，确保可以被正确的并发执行</td>
</tr>
<tr>
<td><strong>collect</strong>()</td>
<td>在Driver的程序中，以数组的形式，返回数据集的所有元素。这通常会在使用filter或者其它操作后，返回一个足够小的数据子集再使用，直接将整个RDD集Collect返回，很可能会让Driver程序OOM</td>
</tr>
<tr>
<td><strong>count</strong>()</td>
<td>返回数据集的元素个数</td>
</tr>
<tr>
<td><strong>first</strong>()</td>
<td>返回数据集的第一个元素（类似于take(1)）</td>
</tr>
<tr>
<td><strong>take</strong>(<em>n</em>)</td>
<td>返回一个数组，由数据集的前n个元素组成。注意，这个操作目前并非在多个节点上，并行执行，而是Driver程序所在机器，单机计算所有的元素(Gateway的内存压力会增大，需要谨慎使用）</td>
</tr>
<tr>
<td><strong>saveAsTextFile</strong>(<em>path</em>)</td>
<td>将数据集的元素，以textfile的形式，保存到本地文件系统，hdfs或者任何其它hadoop支持的文件系统。Spark将会调用每个元素的toString方法，并将它转换为文件中的一行文本</td>
</tr>
<tr>
<td><strong>countByKey</strong>()</td>
<td>计算每一个key的元素的数量</td>
</tr>
<tr>
<td><strong>foreach</strong>(<em>func</em>)</td>
<td>在数据集的每一个元素上，运行函数func。这通常用于更新一个累加器变量，或者和外部存储系统做交互</td>
</tr>
</tbody>
</table>
<p><strong>reduce</strong>(<em>func</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> operator <span class="keyword">import</span> add</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]).reduce(add)</span><br><span class="line"><span class="number">15</span></span><br></pre></td></tr></table></figure>
<p><strong>collect</strong>()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以数组的形式返回一个list</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]).collect()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br></pre></td></tr></table></figure>
<p> <strong>count</strong>()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回数据集的元素个数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sc.parallelize([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]).count()</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>
<p> <strong>first</strong>()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回数据集的第一个元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sc.parallelize([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]).first()</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>  <strong>take</strong>(<em>n</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回一个数组，由数据集的前n个元素组成。</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sc.parallelize([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]).cache().take(<span class="number">2</span>)</span><br><span class="line">[<span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<p> <strong>countByKey</strong>()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 计算每一个key的元素的数量</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rdd = sc.parallelize([(<span class="string">"a"</span>, <span class="number">1</span>), (<span class="string">"b"</span>, <span class="number">1</span>), (<span class="string">"a"</span>, <span class="number">1</span>)])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sorted(rdd.countByKey().items())</span><br><span class="line">[(<span class="string">'a'</span>, <span class="number">2</span>), (<span class="string">'b'</span>, <span class="number">1</span>)]</span><br></pre></td></tr></table></figure>
<p> <strong>foreach</strong>(<em>func</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">对RDD中的所有元素都应用函数func</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span> print(x)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sc.parallelize([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]).foreach(f)</span><br></pre></td></tr></table></figure>
<h4 id="RDD-持久化"><a href="#RDD-持久化" class="headerlink" title="RDD 持久化"></a>RDD 持久化</h4><p><strong>cache</strong>()   持久化RDD使用默认存储水平(<strong>MEMORY_ONLY</strong>)</p>
<p><strong>persist</strong>(<em>storageLevel=StorageLevel(False</em>, <em>True</em>, <em>False</em>, <em>False</em>, <em>1)</em>)</p>
<p>Pyhton只支持这几种存储:</p>
<ul>
<li>MEMORY_ONLY, MEMORY_ONLY_2, MEMORY_AND_DISK, MEMORY_AND_DISK_2, DISK_ONLY, and DISK_ONLY_2.*</li>
</ul>
<p><strong>Removing data</strong></p>
<p>​    使用RDD.unpersist()</p>
<h4 id=""><a href="#" class="headerlink" title=" "></a> </h4><h4 id="DataFrame操作"><a href="#DataFrame操作" class="headerlink" title="DataFrame操作"></a>DataFrame操作</h4><p><strong>columns</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#返回DataFrame的所有列名</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.columns</span><br><span class="line">[<span class="string">'age'</span>, <span class="string">'name'</span>]</span><br></pre></td></tr></table></figure>
<p><strong>count</strong>()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回DataFrame的行数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.count()</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>
<p><strong>createOrReplaceTempView</strong>(<em>name</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建或替换临时视图</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.createOrReplaceTempView(<span class="string">"people"</span>)</span><br></pre></td></tr></table></figure>
<p><strong>createGlobalTempView</strong>(<em>name</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建全局临时视图</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.createGlobalTempView(<span class="string">"people"</span>)</span><br></pre></td></tr></table></figure>
<p><strong>describe</strong>(*<em>cols</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 计算列的基本统计情况</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.describe().show()</span><br><span class="line">+-------+------------------+-----+</span><br><span class="line">|summary|               age| name|</span><br><span class="line">+-------+------------------+-----+</span><br><span class="line">|  count|                 <span class="number">2</span>|    <span class="number">2</span>|</span><br><span class="line">|   mean|               <span class="number">3.5</span>| null|</span><br><span class="line">| stddev|<span class="number">2.1213203435596424</span>| null|</span><br><span class="line">|    min|                 <span class="number">2</span>|Alice|</span><br><span class="line">|    max|                 <span class="number">5</span>|  Bob|</span><br><span class="line">+-------+------------------+-----+</span><br></pre></td></tr></table></figure>
<p><strong>distinct</strong>()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回一个新的DataFrame,只包含原DataFrame的不重复的行</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.distinct().count()</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>
<p><strong>drop</strong>(<em>cols</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除指定列</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.drop(<span class="string">'age'</span>).collect()</span><br><span class="line">[Row(name=<span class="string">u'Alice'</span>), Row(name=<span class="string">u'Bob'</span>)</span><br></pre></td></tr></table></figure>
<p><strong>dropDuplicates</strong>(<em>subset=None</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除重复行,返回一个没有重复行的DataFrame</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> Row</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df = sc.parallelize([ \</span><br><span class="line">     Row(name=<span class="string">'Alice'</span>, age=<span class="number">5</span>, height=<span class="number">80</span>), \</span><br><span class="line">     Row(name=<span class="string">'Alice'</span>, age=<span class="number">5</span>, height=<span class="number">80</span>), \</span><br><span class="line">     Row(name=<span class="string">'Alice'</span>, age=<span class="number">10</span>, height=<span class="number">80</span>)]).toDF()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.dropDuplicates().show()</span><br><span class="line">+---+------+-----+</span><br><span class="line">|age|height| name|</span><br><span class="line">+---+------+-----+</span><br><span class="line">|  <span class="number">5</span>|    <span class="number">80</span>|Alice|</span><br><span class="line">| <span class="number">10</span>|    <span class="number">80</span>|Alice|</span><br><span class="line">+---+------+-----+</span><br></pre></td></tr></table></figure>
<p><strong>dropna</strong>(<em>how=’any’</em>, <em>thresh=None</em>, <em>subset=None</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回一个移除了包含null的行的DataFrame, DataFrame.dropna() 和 DataFrameNaFunctions.drop()互为别名</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">参数:</span></span><br><span class="line"><span class="string">how – ‘any’ or ‘all’. 如果是‘any’, 会删除任何包含nulls的行. 如果是 ‘all’, 仅删除值都是null的行.</span></span><br><span class="line"><span class="string">thresh – 整数, 默认是None. 如果特殊指定 , 则删除 非null值小于阈值的行.这个参数户籍覆盖how.</span></span><br><span class="line"><span class="string">subset – 可以删除指定列的值是na的行.</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df4.na.drop().show()</span><br><span class="line">+---+------+-----+</span><br><span class="line">|age|height| name|</span><br><span class="line">+---+------+-----+</span><br><span class="line">| <span class="number">10</span>|    <span class="number">80</span>|Alice|</span><br><span class="line">+---+------+-----+</span><br></pre></td></tr></table></figure>
<p>dtypes</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#返回所有的列名和他们的数据类型,作为一个列表</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.dtypes</span><br><span class="line">[(<span class="string">'age'</span>, <span class="string">'int'</span>), (<span class="string">'name'</span>, <span class="string">'string'</span>)]</span><br></pre></td></tr></table></figure>
<p><strong>fillna</strong>(<em>value</em>, <em>subset=None</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 替换null值,也叫作na.fill(),</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">参数:</span></span><br><span class="line"><span class="string">value:指定要替换null的值</span></span><br><span class="line"><span class="string">subset:可以指定列进行替换null</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df4.na.fill(<span class="number">50</span>).show()</span><br><span class="line">+---+------+-----+</span><br><span class="line">|age|height| name|</span><br><span class="line">+---+------+-----+</span><br><span class="line">| <span class="number">10</span>|    <span class="number">80</span>|Alice|</span><br><span class="line">|  <span class="number">5</span>|    <span class="number">50</span>|  Bob|</span><br><span class="line">| <span class="number">50</span>|    <span class="number">50</span>|  Tom|</span><br><span class="line">| <span class="number">50</span>|    <span class="number">50</span>| null|</span><br><span class="line">+---+------+-----+</span><br></pre></td></tr></table></figure>
<p><strong>join</strong>(<em>other</em>, <em>on=None</em>, <em>how=None</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据给定的连接表达式,来连接两个DataFrame</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">参数:</span></span><br><span class="line"><span class="string">other:要连接的DataFrame</span></span><br><span class="line"><span class="string">on: 指点连接的条件</span></span><br><span class="line"><span class="string">how: 字符串,默认是inner,必须是其中inner, cross, outer, full, full_outer, left, left_outer, right, right_outer, left_semi和left_anti 其中一个</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.join(df2, df.name == df2.name, <span class="string">'outer'</span>).select(df.name, df2.height).collect()</span><br><span class="line">[Row(name=<span class="keyword">None</span>, height=<span class="number">80</span>), Row(name=<span class="string">'Bob'</span>, height=<span class="number">85</span>), Row(name=<span class="string">'Alice'</span>, height=<span class="keyword">None</span>)]</span><br></pre></td></tr></table></figure>
<p><strong>printSchema</strong>()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以树的形式打印概览</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.printSchema()</span><br><span class="line">root</span><br><span class="line"> |-- age: integer (nullable = true)</span><br><span class="line"> |-- name: string (nullable = true)</span><br></pre></td></tr></table></figure>
<p><strong>RDD</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回一个RDD,可以把DataFrame转化为RDD</span></span><br></pre></td></tr></table></figure>
<p><strong>replace</strong>(<em>to_replace</em>, <em>value=<no value=""></no></em>, <em>subset=None</em>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 返回一个新的DataFrame,通过把一个新值替换原有的值,</span><br></pre></td></tr></table></figure>
<p><strong>withColumn</strong>(<em>colName</em>, <em>col</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回一个新的DataFrame,通过增加一列或者使用相同的名字替换现有的列</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">参数:</span></span><br><span class="line"><span class="string">colName – string, 新列的名字</span></span><br><span class="line"><span class="string">col – 新列的列表达式</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.withColumn(<span class="string">'age2'</span>, df.age + <span class="number">2</span>).collect()</span><br><span class="line">[Row(age=<span class="number">2</span>, name=<span class="string">'Alice'</span>, age2=<span class="number">4</span>), Row(age=<span class="number">5</span>, name=<span class="string">'Bob'</span>, age2=<span class="number">7</span>)]</span><br></pre></td></tr></table></figure>
<p><strong>withColumnRenamed</strong>(<em>existing</em>, <em>new</em>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回一个新的DataFrame,通过对现有的列重命名</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">参数:</span></span><br><span class="line"><span class="string">existing: 现有的列</span></span><br><span class="line"><span class="string">new: 新列</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df.withColumnRenamed(<span class="string">'age'</span>, <span class="string">'age2'</span>).collect()</span><br><span class="line">[Row(age2=<span class="number">2</span>, name=<span class="string">'Alice'</span>), Row(age2=<span class="number">5</span>, name=<span class="string">'Bob'</span>)]</span><br></pre></td></tr></table></figure>
<h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h4><p>[][<a href="http://spark.apache.org/docs/latest/rdd-programming-guide.html]" target="_blank" rel="noopener">http://spark.apache.org/docs/latest/rdd-programming-guide.html]</a></p>
<p>[<a href="http://spark.apache.org/docs/latest/rdd-programming-guide.html][]" target="_blank" rel="noopener">http://spark.apache.org/docs/latest/rdd-programming-guide.html][]</a></p>
<p>[<a href="http://spark.apache.org/docs/2.1.0/api/python/pyspark.html][]" target="_blank" rel="noopener">http://spark.apache.org/docs/2.1.0/api/python/pyspark.html][]</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/21/Spark-UDF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yfchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yfchen's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/21/Spark-UDF/" itemprop="url">Spark-UDF</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-21T19:18:15+08:00">
                2018-04-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spark-UDF"><a href="#Spark-UDF" class="headerlink" title="Spark UDF"></a>Spark UDF</h1><h2 id="User-Defined-Functions-Python"><a href="#User-Defined-Functions-Python" class="headerlink" title="User Defined Functions - Python"></a>User Defined Functions - Python</h2><h4 id="This-document-contains-an-examples-of-creating-a-UDF-in-Python-and-registering-it-for-use-in-Spark-SQL"><a href="#This-document-contains-an-examples-of-creating-a-UDF-in-Python-and-registering-it-for-use-in-Spark-SQL" class="headerlink" title="This document contains an examples of creating a UDF in Python and registering it for use in Spark SQL."></a>This document contains an examples of creating a UDF in Python and registering it for use in Spark SQL.</h4><h5 id="What-is-Pyspark-UDF"><a href="#What-is-Pyspark-UDF" class="headerlink" title="What is Pyspark UDF"></a>What is Pyspark UDF</h5><blockquote>
<ul>
<li>Pyspark UDF is a user defined function executed in Python runtime.</li>
<li>Two types<ol>
<li>Row UDF<ul>
<li>lambda x: x+1</li>
<li>lambda data1, data2: (data1 - data2).year</li>
</ul>
</li>
</ol>
</li>
</ul>
<ol>
<li>Group UDF :<ul>
<li>lambda values: np.mean(np.array(values))</li>
</ul>
</li>
</ol>
</blockquote>
<p>So the row UDF, it’s similar to what you do in Spark with the map operator and pressing a function. </p>
<p>Group UDF, while it’s similar to a row UDF, except you want to do it on a list of values. So it’s similar to do a groupBy followed by a map operator in Scala.</p>
<h5 id="Define-a-function-register-the-function-as-a-UDF-and-set-the-return-type-of-your-UDF"><a href="#Define-a-function-register-the-function-as-a-UDF-and-set-the-return-type-of-your-UDF" class="headerlink" title="Define a function , register the function as a UDF  and set the return type of your UDF."></a>Define a function , register the function as a UDF  and set the return type of your UDF.</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">squared</span><span class="params">(s)</span>:</span></span><br><span class="line">  <span class="keyword">return</span> s * s</span><br><span class="line">sqlContext.udf.register(<span class="string">"squaredWithPython"</span>, squared, LongType())</span><br></pre></td></tr></table></figure>
<h5 id="Call-the-UDF-in-Spark-SQL"><a href="#Call-the-UDF-in-Spark-SQL" class="headerlink" title="Call the UDF in Spark SQL"></a>Call the UDF in Spark SQL</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlContext.range(<span class="number">1</span>, <span class="number">20</span>).registerTempTable(<span class="string">"test"</span>)</span><br><span class="line">result = spark.sql(<span class="string">"select id, squaredWithPython(id) as id_squared from test"</span>)</span><br></pre></td></tr></table></figure>
<h5 id="Use-UDF-with-DataFrames"><a href="#Use-UDF-with-DataFrames" class="headerlink" title="Use UDF with DataFrames"></a>Use UDF with DataFrames</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">%sql select * FROM test</span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"><span class="keyword">from</span> pyspark.sql.functions <span class="keyword">import</span> udf</span><br><span class="line"></span><br><span class="line">spark = SparkSession \</span><br><span class="line">    .builder \</span><br><span class="line">    .appName(<span class="string">"Python Spark SQL basic example"</span>) \</span><br><span class="line">    .config(<span class="string">"spark.some.config.option"</span>, <span class="string">"some-value"</span>) \</span><br><span class="line">    .getOrCreate()</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">squared_udf = udf(squared, LongType())</span><br><span class="line">df = sqlContext.table(<span class="string">"test"</span>)</span><br><span class="line">display(df.select(<span class="string">"id"</span>, squared_udf(<span class="string">"id"</span>).alias(<span class="string">"id_squared"</span>)))</span><br></pre></td></tr></table></figure>
<h3 id="User-Defined-Aggregate-Functions-Scala"><a href="#User-Defined-Aggregate-Functions-Scala" class="headerlink" title="User-Defined Aggregate Functions - Scala"></a>User-Defined Aggregate Functions - Scala</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomConcat</span>(<span class="params"></span>) <span class="keyword">extends</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">spark</span>.<span class="title">sql</span>.<span class="title">expressions</span>.<span class="title">UserDefinedAggregateFunction</span> </span>&#123;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.types._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.expressions.<span class="type">MutableAggregationBuffer</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.<span class="type">Row</span></span><br><span class="line"><span class="comment">// Input Data Type Schema</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inputSchema</span></span>: <span class="type">StructType</span> = <span class="type">StructType</span>(<span class="type">Array</span>(<span class="type">StructField</span>(<span class="string">"description"</span>, <span class="type">StringType</span>)))</span><br><span class="line"><span class="comment">// Intermediate Schema</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bufferSchema</span> </span>= <span class="type">StructType</span>(<span class="type">Array</span>(<span class="type">StructField</span>(<span class="string">"groupConcat"</span>, <span class="type">StringType</span>)))</span><br><span class="line"><span class="comment">// Returned Data Type.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dataType</span></span>: <span class="type">DataType</span> = <span class="type">StringType</span></span><br><span class="line"><span class="comment">// Self-explaining</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deterministic</span> </span>= <span class="literal">true</span></span><br><span class="line"><span class="comment">// This function is called whenever key changes</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initialize</span></span>(buffer: <span class="type">MutableAggregationBuffer</span>): <span class="type">Unit</span> = &#123;buffer(<span class="number">0</span>) = <span class="string">" "</span>.toString&#125;</span><br><span class="line"><span class="comment">// Iterate over each entry of a group</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update</span></span>(buffer: <span class="type">MutableAggregationBuffer</span>, input: <span class="type">Row</span>):<span class="type">Unit</span> = &#123; <span class="keyword">if</span> (!input.isNullAt(<span class="number">0</span>))&#123; buffer(<span class="number">0</span>) = buffer.getString(<span class="number">0</span>) + <span class="string">" "</span> + input.getString(<span class="number">0</span>) &#125;&#125;</span><br><span class="line"><span class="comment">// Merge two partial aggregates</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">merge</span></span>(buffer1: <span class="type">MutableAggregationBuffer</span>, buffer2: <span class="type">Row</span>) : <span class="type">Unit</span> = &#123; buffer1(<span class="number">0</span>) = buffer1.getString(<span class="number">0</span>) + buffer2.getString(<span class="number">0</span>) &#125;</span><br><span class="line"><span class="comment">// Called after all the entries are exhausted.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evaluate</span></span>(buffer: <span class="type">Row</span>) = &#123;buffer.getString(<span class="number">0</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//registe the function</span></span><br><span class="line"><span class="keyword">val</span> newConcat = <span class="keyword">new</span> <span class="type">CustomConcat</span></span><br><span class="line">spark.udf.register(<span class="string">"CustomConcat"</span>, newConcat)</span><br></pre></td></tr></table></figure>
<p>pyspark 不支持UDAF, scala和java支持</p>
<h3 id="map-和-flatMap的区别"><a href="#map-和-flatMap的区别" class="headerlink" title="map 和 flatMap的区别"></a>map 和 flatMap的区别</h3><ul>
<li>map函数会对每一条输入进行指定的操作，然后为每一条输入返回一个对象</li>
<li>flatMap函数则是两个操作的集合<ol>
<li>同map函数一样：对每一条输入进行指定的操作，然后为每一条输入返回一个对象</li>
<li>最后将所有对象合并为一个对象</li>
</ol>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/16/Spark性能优化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yfchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yfchen's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/16/Spark性能优化/" itemprop="url">Spark性能优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-16T19:23:25+08:00">
                2018-04-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Spark资源调优"><a href="#Spark资源调优" class="headerlink" title="Spark资源调优"></a>Spark资源调优</h3><h4 id="调优概述"><a href="#调优概述" class="headerlink" title="调优概述"></a>调优概述</h4><p>Spark的资源参数，基本都可以在spark-submit命令中作为参数设置。很多Spark初学者，通常不知道该设置哪些必要的参数，以及如何设置这些参数，最后就只能胡乱设置，甚至压根儿不设置。资源参数设置的不合理，可能会导致没有充分利用集群资源，作业运行会极其缓慢；或者设置的资源过大，队列没有足够的资源来提供，进而导致各种异常。总之，无论是哪种情况，都会导致Spark作业的运行效率低下，甚至根本无法运行。因此我们必须对Spark作业的资源使用原理有一个清晰的认识，并知道在Spark作业运行过程中，有哪些资源参数是可以设置的，以及如何设置合适的参数值。</p>
<p><img src="D:\Documents\Aibee_intern\spark-base-mech.png" alt="spark-base-mech"></p>
<h4 id="Spark作业基本原理"><a href="#Spark作业基本原理" class="headerlink" title="Spark作业基本原理"></a>Spark作业基本原理</h4><p>详细原理见上图。我们使用spark-submit提交一个Spark作业之后，这个作业就会启动一个对应的Driver进程。根据你使用的部署模式（deploy-mode）不同，Driver进程可能在本地启动，也可能在集群中某个工作节点上启动。Driver进程本身会根据我们设置的参数，占有一定数量的内存和CPU core。而Driver进程要做的第一件事情，就是向集群管理器（可以是Spark Standalone集群，也可以是YARN作为资源管理集群）申请运行Spark作业需要使用的资源，这里的资源指的就是Executor进程。YARN集群管理器会根据我们为Spark作业设置的资源参数，在各个工作节点上，启动一定数量的Executor进程，每个Executor进程都占有一定数量的内存和CPU core。</p>
<p>在申请到了作业执行所需的资源之后，Driver进程就会开始调度和执行我们编写的作业代码了。Driver进程会将我们编写的Spark作业代码分拆为多个stage，每个stage执行一部分代码片段，并为每个stage创建一批task，然后将这些task分配到各个Executor进程中执行。task是最小的计算单元，负责执行一模一样的计算逻辑（也就是我们自己编写的某个代码片段），只是每个task处理的数据不同而已。一个stage的所有task都执行完毕之后，会在各个节点本地的磁盘文件中写入计算中间结果，然后Driver就会调度运行下一个stage。下一个stage的task的输入数据就是上一个stage输出的中间结果。如此循环往复，直到将我们自己编写的代码逻辑全部执行完，并且计算完所有的数据，得到我们想要的结果为止。</p>
<p>Spark是根据shuffle类算子来进行stage的划分。如果我们的代码中执行了某个shuffle类算子（比如reduceByKey、join等），那么就会在该算子处，划分出一个stage界限来。可以大致理解为，shuffle算子执行之前的代码会被划分为一个stage，shuffle算子执行以及之后的代码会被划分为下一个stage。因此一个stage刚开始执行的时候，它的每个task可能都会从上一个stage的task所在的节点，去通过网络传输拉取需要自己处理的所有key，然后对拉取到的所有相同的key使用我们自己编写的算子函数执行聚合操作（比如reduceByKey()算子接收的函数）。这个过程就是shuffle。</p>
<p>当我们在代码中执行了cache/persist等持久化操作时，根据我们选择的持久化级别的不同，每个task计算出来的数据也会保存到Executor进程的内存或者所在节点的磁盘文件中。</p>
<p>因此Executor的内存主要分为三块：第一块是让task执行我们自己编写的代码时使用，默认是占Executor总内存的20%；第二块是让task通过shuffle过程拉取了上一个stage的task的输出后，进行聚合等操作时使用，默认也是占Executor总内存的20%；第三块是让RDD持久化时使用，默认占Executor总内存的60%。</p>
<p>task的执行速度是跟每个Executor进程的CPU core数量有直接关系的。一个CPU core同一时间只能执行一个线程。而每个Executor进程上分配到的多个task，都是以每个task一条线程的方式，多线程并发运行的。如果CPU core数量比较充足，而且分配到的task数量比较合理，那么通常来说，可以比较快速和高效地执行完这些task线程。</p>
<h5 id="资源参数调优"><a href="#资源参数调优" class="headerlink" title="资源参数调优"></a>资源参数调优</h5><p>了解完了Spark作业运行的基本原理之后，对资源相关的参数就容易理解了。所谓的Spark资源参数调优，其实主要就是对Spark运行过程中各个使用资源的地方，通过调节各种参数，来优化资源使用的效率，从而提升Spark作业的执行性能。以下参数就是Spark中主要的资源参数，每个参数都对应着作业运行原理中的某个部分，我们同时也给出了一个调优的参考值。</p>
<h5 id="num-executors"><a href="#num-executors" class="headerlink" title="num-executors"></a>num-executors</h5><ul>
<li>参数说明：该参数用于设置Spark作业总共要用多少个Executor进程来执行。Driver在向YARN集群管理器申请资源时，YARN集群管理器会尽可能按照你的设置来在集群的各个工作节点上，启动相应数量的Executor进程。这个参数非常之重要，如果不设置的话，默认只会给你启动少量的Executor进程，此时你的Spark作业的运行速度是非常慢的。</li>
<li>参数调优建议：每个Spark作业的运行一般设置50~100个左右的Executor进程比较合适，设置太少或太多的Executor进程都不好。设置的太少，无法充分利用集群资源；设置的太多的话，大部分队列可能无法给予充分的资源。</li>
</ul>
<h5 id="executor-memory"><a href="#executor-memory" class="headerlink" title="executor-memory"></a>executor-memory</h5><ul>
<li>参数说明：该参数用于设置每个Executor进程的内存。Executor内存的大小，很多时候直接决定了Spark作业的性能，而且跟常见的JVM OOM异常，也有直接的关联。</li>
<li>参数调优建议：每个Executor进程的内存设置4G~8G较为合适。但是这只是一个参考值，具体的设置还是得根据不同部门的资源队列来定。可以看看自己团队的资源队列的最大内存限制是多少，num-executors乘以executor-memory，是不能超过队列的最大内存量的。此外，如果你是跟团队里其他人共享这个资源队列，那么申请的内存量最好不要超过资源队列最大总内存的1/3~1/2，避免你自己的Spark作业占用了队列所有的资源，导致别的同学的作业无法运行。</li>
</ul>
<h5 id="executor-cores"><a href="#executor-cores" class="headerlink" title="executor-cores"></a>executor-cores</h5><ul>
<li>参数说明：该参数用于设置每个Executor进程的CPU core数量。这个参数决定了每个Executor进程并行执行task线程的能力。因为每个CPU core同一时间只能执行一个task线程，因此每个Executor进程的CPU core数量越多，越能够快速地执行完分配给自己的所有task线程。</li>
<li>参数调优建议：Executor的CPU core数量设置为2~4个较为合适。同样得根据不同部门的资源队列来定，可以看看自己的资源队列的最大CPU core限制是多少，再依据设置的Executor数量，来决定每个Executor进程可以分配到几个CPU core。同样建议，如果是跟他人共享这个队列，那么num-executors * executor-cores不要超过队列总CPU core的1/3~1/2左右比较合适，也是避免影响其他同学的作业运行。</li>
</ul>
<h5 id="driver-memory"><a href="#driver-memory" class="headerlink" title="driver-memory"></a>driver-memory</h5><ul>
<li>参数说明：该参数用于设置Driver进程的内存。</li>
<li>参数调优建议：Driver的内存通常来说不设置，或者设置1G左右应该就够了。唯一需要注意的一点是，如果需要使用collect算子将RDD的数据全部拉取到Driver上进行处理，那么必须确保Driver的内存足够大，否则会出现OOM内存溢出的问题。</li>
</ul>
<h5 id="spark-default-parallelism"><a href="#spark-default-parallelism" class="headerlink" title="spark.default.parallelism"></a>spark.default.parallelism</h5><ul>
<li>参数说明：该参数用于设置每个stage的默认task数量。这个参数极为重要，如果不设置可能会直接影响你的Spark作业性能。</li>
<li>参数调优建议：Spark作业的默认task数量为500~1000个较为合适。很多同学常犯的一个错误就是不去设置这个参数，那么此时就会导致Spark自己根据底层HDFS的block数量来设置task的数量，默认是一个HDFS block对应一个task。通常来说，Spark默认设置的数量是偏少的（比如就几十个task），如果task数量偏少的话，就会导致你前面设置好的Executor的参数都前功尽弃。试想一下，无论你的Executor进程有多少个，内存和CPU有多大，但是task只有1个或者10个，那么90%的Executor进程可能根本就没有task执行，也就是白白浪费了资源！因此Spark官网建议的设置原则是，设置该参数为num-executors * executor-cores的2~3倍较为合适，比如Executor的总CPU core数量为300个，那么设置1000个task是可以的，此时可以充分地利用Spark集群的资源。</li>
</ul>
<h5 id="spark-storage-memoryFraction"><a href="#spark-storage-memoryFraction" class="headerlink" title="spark.storage.memoryFraction"></a>spark.storage.memoryFraction</h5><ul>
<li>参数说明：该参数用于设置RDD持久化数据在Executor内存中能占的比例，默认是0.6。也就是说，默认Executor 60%的内存，可以用来保存持久化的RDD数据。根据你选择的不同的持久化策略，如果内存不够时，可能数据就不会持久化，或者数据会写入磁盘。</li>
<li>参数调优建议：如果Spark作业中，有较多的RDD持久化操作，该参数的值可以适当提高一些，保证持久化的数据能够容纳在内存中。避免内存不够缓存所有的数据，导致数据只能写入磁盘中，降低了性能。但是如果Spark作业中的shuffle类操作比较多，而持久化操作比较少，那么这个参数的值适当降低一些比较合适。此外，如果发现作业由于频繁的gc导致运行缓慢（通过spark web ui可以观察到作业的gc耗时），意味着task执行用户代码的内存不够用，那么同样建议调低这个参数的值。</li>
</ul>
<h5 id="spark-shuffle-memoryFraction"><a href="#spark-shuffle-memoryFraction" class="headerlink" title="spark.shuffle.memoryFraction"></a>spark.shuffle.memoryFraction</h5><ul>
<li>参数说明：该参数用于设置shuffle过程中一个task拉取到上个stage的task的输出后，进行聚合操作时能够使用的Executor内存的比例，默认是0.2。也就是说，Executor默认只有20%的内存用来进行该操作。shuffle操作在进行聚合时，如果发现使用的内存超出了这个20%的限制，那么多余的数据就会溢写到磁盘文件中去，此时就会极大地降低性能。</li>
<li>参数调优建议：如果Spark作业中的RDD持久化操作较少，shuffle操作较多时，建议降低持久化操作的内存占比，提高shuffle操作的内存占比比例，避免shuffle过程中数据过多时内存不够用，必须溢写到磁盘上，降低了性能。此外，如果发现作业由于频繁的gc导致运行缓慢，意味着task执行用户代码的内存不够用，那么同样建议调低这个参数的值。</li>
</ul>
<h2 id="资源参数参考示例"><a href="#资源参数参考示例" class="headerlink" title="资源参数参考示例"></a>资源参数参考示例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./bin/pyspark \</span><br><span class="line">  --master yarn-cluster \</span><br><span class="line">  --num-executors 100 \</span><br><span class="line">  --executor-memory 6G \</span><br><span class="line">  --executor-cores 4 \</span><br><span class="line">  --driver-memory 1G \</span><br><span class="line">  --conf spark.default.parallelism=1000 \</span><br><span class="line">  --conf spark.storage.memoryFraction=0.5 \</span><br><span class="line">  --conf spark.shuffle.memoryFraction=0.3 \</span><br></pre></td></tr></table></figure>
<p>参考文章: <a href="https://tech.meituan.com/spark-tuning-basic.html" target="_blank" rel="noopener">https://tech.meituan.com/spark-tuning-basic.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/30/Hive学习笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yfchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yfchen's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/30/Hive学习笔记/" itemprop="url">Hive学习笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-30T19:10:05+08:00">
                2018-03-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Hive学习笔记"><a href="#Hive学习笔记" class="headerlink" title="Hive学习笔记"></a>Hive学习笔记</h2><h4 id="1-Hive基础"><a href="#1-Hive基础" class="headerlink" title="1.Hive基础"></a>1.Hive基础</h4><h5 id="1-1-hive-–help-–service-cli"><a href="#1-1-hive-–help-–service-cli" class="headerlink" title="1.1 hive –help –service cli"></a>1.1 hive –help –service cli</h5><h6 id="usage-hive"><a href="#usage-hive" class="headerlink" title="usage: hive"></a>usage: hive</h6><h6 id="d-–define-lt-key-value-gt-Variable-subsitution-to-apply-to-hive-commands"><a href="#d-–define-lt-key-value-gt-Variable-subsitution-to-apply-to-hive-commands" class="headerlink" title="-d,–define &lt;key=value&gt;              Variable subsitution to apply to hive commands."></a>-d,–define &lt;key=value&gt;              Variable subsitution to apply to hive commands.</h6><h6 id="e-g-d-A-B-or-–define-A-B"><a href="#e-g-d-A-B-or-–define-A-B" class="headerlink" title="e.g. -d A=B or –define A=B"></a>e.g. -d A=B or –define A=B</h6><h6 id="–database-Specify-the-database-to-use"><a href="#–database-Specify-the-database-to-use" class="headerlink" title="–database       Specify the database to use"></a>–database <databasename>      Specify the database to use</databasename></h6><h6 id="e-SQL-from-command-line"><a href="#e-SQL-from-command-line" class="headerlink" title="-e               SQL from command line"></a>-e <quoted-query-string>              SQL from command line</quoted-query-string></h6><h6 id="f-SQL-from-files"><a href="#f-SQL-from-files" class="headerlink" title="-f                                     SQL from files"></a>-f <filename>                                    SQL from files</filename></h6><h6 id="H-–help-Print-help-information"><a href="#H-–help-Print-help-information" class="headerlink" title="-H,–help                                            Print help information"></a>-H,–help                                            Print help information</h6><h6 id="–hiveconf-lt-property-value-gt-Use-value-for-given-property"><a href="#–hiveconf-lt-property-value-gt-Use-value-for-given-property" class="headerlink" title="–hiveconf &lt;property=value&gt;   Use value for given property"></a>–hiveconf &lt;property=value&gt;   Use value for given property</h6><h6 id="–hivevar-lt-key-value-gt-Variable-subsitution-to-apply-to-hive"><a href="#–hivevar-lt-key-value-gt-Variable-subsitution-to-apply-to-hive" class="headerlink" title="–hivevar &lt;key=value&gt;               Variable subsitution to apply to hive"></a>–hivevar &lt;key=value&gt;               Variable subsitution to apply to hive</h6><h6 id="commands-e-g-–hivevar-A-B"><a href="#commands-e-g-–hivevar-A-B" class="headerlink" title="commands. e.g. –hivevar A=B"></a>commands. e.g. –hivevar A=B</h6><h6 id="i-Initialization-SQL-file"><a href="#i-Initialization-SQL-file" class="headerlink" title="-i                                      Initialization SQL file"></a>-i <filename>                                     Initialization SQL file</filename></h6><h6 id="S-–silent-Silent-mode-in-interactive-shell"><a href="#S-–silent-Silent-mode-in-interactive-shell" class="headerlink" title="-S,–silent                                           Silent mode in interactive shell"></a>-S,–silent                                           Silent mode in interactive shell</h6><h6 id="v-–verbose-Verbose-mode-echo-executed-SQL-to-the-console"><a href="#v-–verbose-Verbose-mode-echo-executed-SQL-to-the-console" class="headerlink" title="-v,–verbose                                      Verbose mode (echo executed SQL to the console)"></a>-v,–verbose                                      Verbose mode (echo executed SQL to the console)</h6><h5 id="1-2-Hive中“一次使用命令”"><a href="#1-2-Hive中“一次使用命令”" class="headerlink" title="1.2 Hive中“一次使用命令”"></a>1.2 Hive中“一次使用命令”</h5><p><code>hive -e &quot;SELECT * FROM mytable LIMIT 3&quot;;</code></p>
<h5 id="1-3-Hive中执行shell命令"><a href="#1-3-Hive中执行shell命令" class="headerlink" title="1.3 Hive中执行shell命令"></a>1.3 Hive中执行shell命令</h5><h6 id="hive-gt-pwd"><a href="#hive-gt-pwd" class="headerlink" title="hive&gt; ! pwd;"></a>hive&gt; ! pwd;</h6><h5 id="1-4-Hive脚本中使用-–-进行注释"><a href="#1-4-Hive脚本中使用-–-进行注释" class="headerlink" title="1.4 Hive脚本中使用 – 进行注释"></a>1.4 Hive脚本中使用 – 进行注释</h5><h6 id="–-Copyright-（c）-2012-Megacorp-LLC"><a href="#–-Copyright-（c）-2012-Megacorp-LLC" class="headerlink" title="– Copyright （c） 2012 Megacorp, LLC."></a>– Copyright （c） 2012 Megacorp, LLC.</h6><h4 id="2-hive数据类型"><a href="#2-hive数据类型" class="headerlink" title="2. hive数据类型"></a>2. hive数据类型</h4><h5 id="2-1-基本数据类型"><a href="#2-1-基本数据类型" class="headerlink" title="2.1 基本数据类型"></a>2.1 基本数据类型</h5><table>
<thead>
<tr>
<th>类型</th>
<th>长度</th>
</tr>
</thead>
<tbody>
<tr>
<td>TINYINY</td>
<td>1byte</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2byte</td>
</tr>
<tr>
<td>INT</td>
<td>4byte</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8byte</td>
</tr>
<tr>
<td>BOOLEAN</td>
<td>布尔类型，True or False</td>
</tr>
<tr>
<td>FlOAT</td>
<td>单浮点精度</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>双浮点精度</td>
</tr>
<tr>
<td>String</td>
<td>字符序列。可以指定字符集。可以使用单引号或双引号</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>整数，浮点数或者字符串</td>
</tr>
</tbody>
</table>
<h5 id="2-2-集合数据类型"><a href="#2-2-集合数据类型" class="headerlink" title="2.2 集合数据类型"></a>2.2 集合数据类型</h5><table>
<thead>
<tr>
<th>数据类型</th>
<th>描述</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>STRUCT</td>
<td></td>
<td>struct（‘John’, ‘Doe’）</td>
</tr>
<tr>
<td>MAP</td>
<td></td>
<td>map(‘first’, ‘John’, ‘last’)</td>
</tr>
<tr>
<td>ARRAY</td>
<td></td>
<td>Array(‘John’, ‘Doe’)</td>
</tr>
</tbody>
</table>
<h5 id="2-3-文件数据编码"><a href="#2-3-文件数据编码" class="headerlink" title="2.3 文件数据编码"></a>2.3 文件数据编码</h5><table>
<thead>
<tr>
<th>分割符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>\n</td>
<td>对于文本来说，每行都是一条记录，因此换行符与可以分割记录</td>
</tr>
<tr>
<td>^A</td>
<td>用于分割字段（列）。在CREATEA TABLE 语句中可以使用八进制编码\001表示</td>
</tr>
<tr>
<td>^B</td>
<td>用于分割ARRAY或者STRUCT中的元素，或用于MAP中键-值对之间的分割。<br>在CREATE TABLE语句中可以使用二进制编码\002表示</td>
</tr>
<tr>
<td>^C</td>
<td>用于MAP 中键和值之间的分割。在CREATE TABLE 语句中可以使用八进制编码\003表示</td>
</tr>
</tbody>
</table>
<h5 id="2-4-读时模式"><a href="#2-4-读时模式" class="headerlink" title="2.4 读时模式"></a>2.4 读时模式</h5><table>
<thead>
<tr>
<th style="text-align:left">传统数据库</th>
<th style="text-align:left">Hive</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">写时模式—数据在写入时对模式进行检查</td>
<td style="text-align:left">读时模式—数据不会再加载时进行验证，<br>而是在查询时进行</td>
</tr>
</tbody>
</table>
<h4 id="3-数据定义"><a href="#3-数据定义" class="headerlink" title="3. 数据定义"></a>3. 数据定义</h4><h5 id="3-1-数据库"><a href="#3-1-数据库" class="headerlink" title="3.1 数据库"></a>3.1 数据库</h5><h6 id="查看所有的数据库"><a href="#查看所有的数据库" class="headerlink" title="查看所有的数据库"></a>查看所有的数据库</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW DATABASES;</span><br></pre></td></tr></table></figure>
<h6 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE IF NOT EXISTS test</span><br><span class="line">COMMENT &apos;Test hive&apos;</span><br><span class="line">WITH DBPROPERTIES (&apos;createor&apos; = &apos;Mike&apos;, &apos;date&apos; = &apos;2018-03-27&apos;)</span><br><span class="line">LOCATION &apos;/home/cyf/&apos;</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<h6 id="查看数据库信息"><a href="#查看数据库信息" class="headerlink" title="查看数据库信息"></a>查看数据库信息</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESCRIBE DATABASE TEST;</span><br></pre></td></tr></table></figure>
<p>查看数据库详细信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESCRIBE DATABASE EXTENDED test;</span><br></pre></td></tr></table></figure>
<h6 id="修改数据库"><a href="#修改数据库" class="headerlink" title="修改数据库"></a>修改数据库</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER DATABASE test SET DBPROPERTIES (&apos;edited-by&apos; = &apos;John&apos;)</span><br></pre></td></tr></table></figure>
<h6 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE IF EXISTS test；</span><br></pre></td></tr></table></figure>
<h6 id="使用数据库"><a href="#使用数据库" class="headerlink" title="使用数据库"></a>使用数据库</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE test；</span><br></pre></td></tr></table></figure>
<h5 id="3-2-数据库中的表"><a href="#3-2-数据库中的表" class="headerlink" title="3.2 数据库中的表"></a>3.2 数据库中的表</h5><h6 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS toshop (member_id string, area_id string, file_id string,shop_id                                        string, mac_id string, user_min int, user_times int,                                            create_at timestamp, ai int)</span><br><span class="line">COMMENT &apos;The data of arrived&apos;</span><br><span class="line">TBLPROPERTIES (&apos;creator&apos; = &apos;Mike&apos;, &apos;create_at&apos; = &apos;2018-03-27 17:01:00&apos;)</span><br><span class="line">ROW FORMAT DELIMITED FIELDS TERMINATED by &apos;,&apos;</span><br><span class="line">LOCATION &apos;/home/cyf/&apos;</span><br><span class="line">STORED AS TEXTFILE;</span><br></pre></td></tr></table></figure>
<h6 id="查看表信息"><a href="#查看表信息" class="headerlink" title="查看表信息"></a>查看表信息</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESCRIBE EXTENTED test;</span><br></pre></td></tr></table></figure>
<p><strong>前面创建的表都是管理表也被称为内部表，这种表删除表时也会把表中的数据删除，外部表在删除表的时候不会删除掉这份数据</strong></p>
<h6 id="创建外部表"><a href="#创建外部表" class="headerlink" title="创建外部表"></a>创建外部表</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE EXTERNAL TABLE IF NOT EXISTS toshop (member_id string, area_id string, file_id string,shop_id                                        string, mac_id string, user_min int, user_times int,                                            create_at timestamp, ai int)</span><br><span class="line">COMMENT &apos;The data of arrived&apos;</span><br><span class="line">TBLPROPERTIES (&apos;creator&apos; = &apos;Mike&apos;, &apos;create_at&apos; = &apos;2018-03-27 17:01:00&apos;)</span><br><span class="line">ROW FORMAT DELIMITED FIELDS TERMINATED by &apos;,&apos;</span><br><span class="line">LOCATION &apos;/home/cyf/&apos;;</span><br></pre></td></tr></table></figure>
<h6 id="分区表"><a href="#分区表" class="headerlink" title="分区表"></a>分区表</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE EXTERNAL TABLE IF NOT EXISTS toshop (member_id string, area_id string, file_id string,shop_id                                        string, mac_id string, user_min int, user_times int,                                            create_at timestamp, ai int)</span><br><span class="line">PARTITIONED BY (area_id string, ai int)</span><br><span class="line">COMMENT &apos;The data of arrived&apos;</span><br><span class="line">TBLPROPERTIES (&apos;creator&apos; = &apos;Mike&apos;, &apos;create_at&apos; = &apos;2018-03-27 17:01:00&apos;)</span><br><span class="line">ROW FORMAT DELIMITED FIELDS TERMINATED by &apos;,&apos;</span><br><span class="line">LOCATION &apos;/home/cyf/&apos;;</span><br></pre></td></tr></table></figure>
<h6 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE IF EXISTS test;</span><br></pre></td></tr></table></figure>
<h4 id="4-数据操作"><a href="#4-数据操作" class="headerlink" title="4.数据操作"></a>4.数据操作</h4><h6 id="装载数据"><a href="#装载数据" class="headerlink" title="装载数据"></a>装载数据</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LOAD DATA LOCAL INPATH &apos;/home/cyf/&apos;</span><br><span class="line">OVERWRITE INTO TABLE test</span><br><span class="line">PARTITION (country = &apos;US&apos;, state = &apos;CA&apos;);</span><br></pre></td></tr></table></figure>
<h6 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT OVERWRITE TABLE test </span><br><span class="line">PARTITION (country = &apos;US&apos;, state = &apos;OR&apos;)</span><br><span class="line">SELECT * FROM staged_employees se</span><br><span class="line">WHERE se.cnty = &apos;US&apos; AND se.st = &apos;OR&apos;;</span><br></pre></td></tr></table></figure>
<h6 id="单个查询语句中创建表并加载数据"><a href="#单个查询语句中创建表并加载数据" class="headerlink" title="单个查询语句中创建表并加载数据"></a>单个查询语句中创建表并加载数据</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE ca_employees </span><br><span class="line">AS SELECT name, salary,address</span><br><span class="line">FROM employees</span><br><span class="line">WHERE se.state = &apos;CA&apos;;</span><br></pre></td></tr></table></figure>
<h6 id="导出数据"><a href="#导出数据" class="headerlink" title="导出数据"></a>导出数据</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT OVERWRITE LOCAL DIRECTORY &apos;/tmp/ca_employees&apos;</span><br><span class="line">SELECT name, salary, address</span><br><span class="line">FROM employees</span><br><span class="line">WHERE se.staet = &apos;CA&apos;</span><br></pre></td></tr></table></figure>
<h4 id="5-查询"><a href="#5-查询" class="headerlink" title="5. 查询"></a>5. 查询</h4><h6 id="5-1-SELECT语句"><a href="#5-1-SELECT语句" class="headerlink" title="5.1 SELECT语句"></a>5.1 SELECT语句</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT member_id,sum(sales_amout) as a_week_amount FROM purchase2 </span><br><span class="line">WHERE create_time&gt;&quot;2018-02-15&quot; AND create_time&lt;&quot;2018-03-15&quot; GROUP BY member_id;</span><br></pre></td></tr></table></figure>
<h6 id="5-2-使用正则"><a href="#5-2-使用正则" class="headerlink" title="5.2 使用正则"></a>5.2 使用正则</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT symbol, &apos;price.*&apos; FROM stocks;</span><br></pre></td></tr></table></figure>
<h6 id="5-3-使用自带函数"><a href="#5-3-使用自带函数" class="headerlink" title="5.3 使用自带函数"></a>5.3 使用自带函数</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT upper(name), salary, deductions[&quot;Federal Taxes&quot;],</span><br><span class="line">round(salary * (1 - deductions[&quot;Federal Taxes&quot;])) FROM employees;</span><br></pre></td></tr></table></figure>
<h6 id="5-4-聚合GROUP-BY"><a href="#5-4-聚合GROUP-BY" class="headerlink" title="5.4 聚合GROUP BY"></a>5.4 聚合GROUP BY</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT member_id,sum(user_times) as half_year_times FROM toshop WHERE create_at&gt;&quot;2018-12-15&quot; AND create_time&lt;&quot;2018-03-15&quot; GROUP BY member_id LIMIT 5;</span><br></pre></td></tr></table></figure>
<h6 id="5-5-计算次序"><a href="#5-5-计算次序" class="headerlink" title="5.5 计算次序"></a>5.5 计算次序</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT prob_name, prob_price FROM prodcts </span><br><span class="line">WHERE (ven_id = 1002 OR vend_id = 1003) AND prob_price &gt;=10;</span><br></pre></td></tr></table></figure>
<h6 id="5-6-SELECT子语句顺序"><a href="#5-6-SELECT子语句顺序" class="headerlink" title="5.6 SELECT子语句顺序"></a>5.6 SELECT子语句顺序</h6><p><strong>SECECT FROM WHERE GROUP BY HAVING ORDER BY  LIMIT</strong></p>
<h6 id="5-7-JOIN"><a href="#5-7-JOIN" class="headerlink" title="5.7 JOIN"></a>5.7 JOIN</h6><h6 id="5-7-1-INNER-JOIN"><a href="#5-7-1-INNER-JOIN" class="headerlink" title="5.7.1 INNER JOIN"></a>5.7.1 INNER JOIN</h6><p><strong>内连接中，只有进行连接的两个表中都存在与连接标准相匹配的数据才会被保留下来</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.ymd, a.price_close, b.price_close FROM stocks a JOIN stocks b ON a.ymd = b.ymd</span><br><span class="line">WHERE a.symbol = &apos;APPLE&apos; AND b.symbol = &apos;IBM&apos;;</span><br></pre></td></tr></table></figure>
<p><strong>Hive 目前还不支持在ON子句中的谓词间使用OR</strong></p>
<h6 id="多于两张表的JOIN操作"><a href="#多于两张表的JOIN操作" class="headerlink" title="多于两张表的JOIN操作"></a>多于两张表的JOIN操作</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.ymd, a.price_close, b.price_close, c.price_close</span><br><span class="line">FROM stocks a JOIN stocks b ON a.ymd = b.ymd </span><br><span class="line">              JOIN stocks c ON a.ymd = c.ymd</span><br><span class="line">WHERE a.symbol = &apos;APPL&apos; AND b.symbol = &apos;IBM&apos; AND c.symbol = &apos;GE&apos;;</span><br></pre></td></tr></table></figure>
<h6 id="5-7-2-LEFT-JOIN"><a href="#5-7-2-LEFT-JOIN" class="headerlink" title="5.7.2 LEFT JOIN"></a>5.7.2 LEFT JOIN</h6><p><strong>LEFT JOIN 返回包括左表中的所有记录和右表中联结字段相等的记录</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.ymd, a.price_close, b.price_close FROM stocks a LEFT JOIN stocks b ON a.ymd = b.ymd</span><br><span class="line">WHERE a.symbol = &apos;APPLE&apos; AND b.symbol = &apos;IBM&apos;;</span><br></pre></td></tr></table></figure>
<p><strong>RIGHT JOIN 返回包括右表中的所有记录和右表中联结字段相等的记录</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.ymd, a.price_close, b.price_close FROM stocks a RIGHT JOIN stocks b ON a.ymd = b.ymd</span><br><span class="line">WHERE a.symbol = &apos;APPLE&apos; AND b.symbol = &apos;IBM&apos;;</span><br></pre></td></tr></table></figure>
<h6 id="5-7-3-FULL-OUTER-JOIN"><a href="#5-7-3-FULL-OUTER-JOIN" class="headerlink" title="5.7.3 FULL OUTER JOIN"></a>5.7.3 FULL OUTER JOIN</h6><p><strong>FULL OUTER JOIN 会返回所有表中符合WHERE语句条件的所有记录，不符合的就使用NULL替代</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT s.ymd, s.symbol, s.price_close, d.dividend</span><br><span class="line">FROM dividends d FULL OUTER JOIN stocks s ON d.ymd = s.ymd AND d.symbol = s.symbol</span><br><span class="line">WHERE s.symbol = &apos;AAPL&apos;</span><br></pre></td></tr></table></figure>
<h6 id="5-8-ORDER-BY-和-SORT-BY"><a href="#5-8-ORDER-BY-和-SORT-BY" class="headerlink" title="5.8 ORDER BY 和 SORT BY"></a>5.8 ORDER BY 和 SORT BY</h6><p><strong>ORDER BY 全局排序</strong></p>
<p><strong>SORT BY 对每个reducer进行排序，也就是局部排序</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT s.ymd, s.symbol, s.price_close</span><br><span class="line">FROM stocks s</span><br><span class="line">ORDER BY s.ymd ASC, s.symbol DESC;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT s.ymd, s.symbol, s.price_close</span><br><span class="line">FROM stocks s</span><br><span class="line">ORDER BY s.ymd ASC, s.symbol DESC;</span><br></pre></td></tr></table></figure>
<h6 id="5-9-嵌套SELECT语句"><a href="#5-9-嵌套SELECT语句" class="headerlink" title="5.9 嵌套SELECT语句"></a>5.9 嵌套SELECT语句</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FROM (</span><br><span class="line">SELECT upper(name), salary, deductions[&quot;Federal Taxes&quot;] as fed_taxes,</span><br><span class="line">round(salary * (1 - dedutions[&quot;Federal Taxes&quot;])) as salary_minus_fed_taxes</span><br><span class="line">FROM employees</span><br><span class="line">) e</span><br><span class="line">SELECT e.name, e.salary_minus_fed_taxes</span><br><span class="line">WHERE e.salary_minus_fed_taxes &gt; 7000;</span><br></pre></td></tr></table></figure>
<h6 id="5-10-UNION-ALL"><a href="#5-10-UNION-ALL" class="headerlink" title="5.10 UNION ALL"></a>5.10 UNION ALL</h6><p><strong>UNION ALL 可以将2个或多个表进行合并，每一个union子查询都必须具有相同的列，而且对应的每个字段的数据类型必须是一致的。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT log.ymd, log.level, log.message</span><br><span class="line">  FROM (</span><br><span class="line">    SELECT l1.ymd, l1.level, l1.message, &apos;Log1&apos; AS source</span><br><span class="line">    FROM log1 l1</span><br><span class="line">  UNION ALL</span><br><span class="line">    SELECT l2.ymd, l2.level, l2.message, &apos;Log2&apos; AS source</span><br><span class="line">    FROM log1 l2</span><br><span class="line">      ) log</span><br><span class="line"> SORT BY log.ymd ASC;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/24/SQL数据库面试题以及答案-50例题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yfchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yfchen's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/24/SQL数据库面试题以及答案-50例题/" itemprop="url">SQL数据库面试题以及答案(50例题)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-24T19:07:19+08:00">
                2018-03-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="SQL数据库面试题以及答案（50例题）"><a href="#SQL数据库面试题以及答案（50例题）" class="headerlink" title="SQL数据库面试题以及答案（50例题）"></a>SQL数据库面试题以及答案（50例题）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Student(S#,Sname,Sage,Ssex)学生表</span><br><span class="line">S#：学号</span><br><span class="line">Sname：学生姓名</span><br><span class="line">Sage：学生年龄</span><br><span class="line">Ssex：学生性别</span><br><span class="line">Course(C#,Cname,T#)课程表</span><br><span class="line">C#：课程编号</span><br><span class="line">Cname：课程名称</span><br><span class="line">T#：教师编号</span><br><span class="line">SC(S#,C#,score)成绩表</span><br><span class="line">S#：学号</span><br><span class="line">C#：课程编号</span><br><span class="line">score：成绩</span><br><span class="line">Teacher(T#,Tname)教师表</span><br><span class="line">T#：教师编号：</span><br><span class="line">Tname：教师名字</span><br></pre></td></tr></table></figure>
<h6 id="自己编了一些数据如下"><a href="#自己编了一些数据如下" class="headerlink" title="自己编了一些数据如下"></a>自己编了一些数据如下</h6><h6 id="创建四个表"><a href="#创建四个表" class="headerlink" title="创建四个表"></a>创建四个表</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `Student`(`S#` VARCHAR(20), `Sname` VARCHAR(20), `Sage` INT, `Ssex` VARCHAR(20)) CHARSET = utf8;</span><br><span class="line">CREATE TABLE `Course`(`C#` VARCHAR(20), `Cname` VARCHAR(20), `T#` VARCHAR(20)) CHARSET = utf8;</span><br><span class="line">CREATE TABLE `SC`(`S#` VARCHAR(20), `C#` VARCHAR(20), `score` INT) ;</span><br><span class="line">CREATe TABLE `Teacher`(`T#` VARCHAR(20), `Tname` VARCHAR(20)) CHARSET = utf8 ;</span><br></pre></td></tr></table></figure>
<h6 id="分别给四个表中插入数据"><a href="#分别给四个表中插入数据" class="headerlink" title="分别给四个表中插入数据"></a>分别给四个表中插入数据</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO Course(`C#`, `Cname`, `T#`) VALUES (&apos;001&apos;, &apos;企业管理&apos;, &apos;李四&apos;), (&apos;002&apos;, &apos;马克思&apos;, &apos;李五&apos;), (&apos;003&apos;, &apos;OO&amp;UML&apos;, &apos;叶平&apos;), (&apos;004&apos;, &apos;数据库&apos;, &apos;张三&apos;), (&apos;005&apos;, &apos;英语&apos;, &apos;王五&apos;);</span><br><span class="line">INSERT INTO Course(`C#`, `Cname`, `T#`) VALUES (&apos;001&apos;, &apos;企业管理&apos;, &apos;T001&apos;), (&apos;002&apos;, &apos;马克思&apos;, &apos;T002&apos;), (&apos;003&apos;, &apos;OO&amp;UML&apos;, &apos;T003&apos;), (&apos;004&apos;, &apos;数据库&apos;, &apos;T004&apos;), (&apos;005&apos;, &apos;英语&apos;, &apos;T005&apos;);</span><br><span class="line"></span><br><span class="line">INSERT INTO SC(`S#`, `C#`, `score`) VALUES(&apos;0001&apos;, &apos;001&apos;, 89),(&apos;0001&apos;, &apos;002&apos;, 86),(&apos;0001&apos;, &apos;003&apos;, 86),(&apos;0001&apos;, &apos;004&apos;, 86),(&apos;0001&apos;, &apos;004&apos;, 86),(&apos;0001&apos;, &apos;005&apos;, 86),</span><br><span class="line">                                           (&apos;0002&apos;, &apos;001&apos;, 80),(&apos;0001&apos;, &apos;003&apos;, 59),</span><br><span class="line">										                       (&apos;0003&apos;, &apos;002&apos;, 86),(&apos;0003&apos;, &apos;003&apos;, 86),</span><br><span class="line">				                           (&apos;0004&apos;, &apos;001&apos;, 89),(&apos;0004&apos;, &apos;002&apos;, 86),(&apos;0004&apos;, &apos;003&apos;, 86),(&apos;0004&apos;, &apos;004&apos;, 86),(&apos;0004&apos;, &apos;004&apos;, 86),(&apos;0004&apos;, &apos;005&apos;, 86),</span><br><span class="line">										   (&apos;0005&apos;, &apos;001&apos;, 89),(&apos;0005&apos;, &apos;002&apos;, 96),(&apos;0005&apos;, &apos;003&apos;, 96),(&apos;0005&apos;, &apos;004&apos;, 86),(&apos;0005&apos;, &apos;004&apos;, 66),(&apos;0005&apos;, &apos;005&apos;, 66),</span><br><span class="line">                                           (&apos;0006&apos;, &apos;001&apos;, 49),(&apos;0006&apos;, &apos;002&apos;, 76),(&apos;0006&apos;, &apos;003&apos;, 66),(&apos;0006&apos;, &apos;004&apos;, 56),(&apos;0006&apos;, &apos;005&apos;, 86),</span><br><span class="line">										   (&apos;0007&apos;, &apos;001&apos;, 60),(&apos;0007&apos;, &apos;003&apos;, 79),</span><br><span class="line">										   (&apos;0008&apos;, &apos;001&apos;, 80),(&apos;0008&apos;, &apos;003&apos;, 70),</span><br><span class="line">										   (&apos;0009&apos;, &apos;002&apos;, 86),(&apos;0009&apos;, &apos;003&apos;, 86),</span><br><span class="line">										   (&apos;1000&apos;, &apos;001&apos;, 66),(&apos;1000&apos;, &apos;003&apos;, 66),</span><br><span class="line">										   (&apos;1001&apos;, &apos;001&apos;, 99),(&apos;1001&apos;, &apos;002&apos;, 76),(&apos;1001&apos;, &apos;003&apos;, 66),(&apos;1001&apos;, &apos;004&apos;, 76),(&apos;1001&apos;, &apos;004&apos;, 86),(&apos;1001&apos;, &apos;005&apos;, 96),</span><br><span class="line">										   (&apos;1002&apos;, &apos;001&apos;, 89),(&apos;1002&apos;, &apos;002&apos;, 86),(&apos;1002&apos;, &apos;003&apos;, 86),(&apos;1002&apos;, &apos;004&apos;, 86),(&apos;1002&apos;, &apos;004&apos;, 86),(&apos;1002&apos;, &apos;005&apos;, 86),</span><br><span class="line">										   (&apos;00013&apos;, &apos;001&apos;, 60),(&apos;00013&apos;, &apos;003&apos;, 79),</span><br><span class="line">										   (&apos;00014&apos;, &apos;001&apos;, 60),(&apos;00014&apos;, &apos;003&apos;, 79),</span><br><span class="line">										   (&apos;00015&apos;, &apos;001&apos;, 80),(&apos;00015&apos;, &apos;003&apos;, 59),</span><br><span class="line">										   (&apos;00016&apos;, &apos;001&apos;, 64),(&apos;00016&apos;, &apos;003&apos;, 71),</span><br><span class="line">										   (&apos;00017&apos;, &apos;001&apos;, 70),(&apos;00017&apos;, &apos;003&apos;, 99),</span><br><span class="line">										   (&apos;00018&apos;, &apos;001&apos;, 60),(&apos;00018&apos;, &apos;003&apos;, 79),</span><br><span class="line">										   (&apos;00019&apos;, &apos;001&apos;, 60),(&apos;00019&apos;, &apos;003&apos;, 79),</span><br><span class="line">										   (&apos;00020&apos;, &apos;001&apos;, 60),(&apos;00020&apos;, &apos;003&apos;, 79);</span><br><span class="line"></span><br><span class="line">INSERT INTO Teacher (`T#`, Tname) VALUES (&apos;T001&apos;, &apos;李四&apos;), (&apos;T002&apos;, &apos;李五&apos;), (&apos;T003&apos;, &apos;叶平&apos;), (&apos;T004&apos;, &apos;张三&apos;), (&apos;T005&apos;, 王五);</span><br></pre></td></tr></table></figure>
<h6 id="查看一下四张表"><a href="#查看一下四张表" class="headerlink" title="查看一下四张表"></a>查看一下四张表</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM Student;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM Course;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM SC;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM Teacher;</span><br></pre></td></tr></table></figure>
<h4 id="1-查询“001”课程比“002”课程成绩高的所有学生的学号"><a href="#1-查询“001”课程比“002”课程成绩高的所有学生的学号" class="headerlink" title="1. 查询“001”课程比“002”课程成绩高的所有学生的学号"></a>1. 查询“001”课程比“002”课程成绩高的所有学生的学号</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT e1.`S#` FROM (SELECT `S#`,score FROM SC WHERE `C#`=&apos;001&apos;) AS e1 ,</span><br><span class="line">(SELECT `S#`,score FROM SC WHERE `C#`=&apos;002&apos;) AS e2 </span><br><span class="line">WHERE e1.`S#`=e2.`S#` AND e1.score&gt;e2.scoreore;</span><br></pre></td></tr></table></figure>
<h4 id="2-查询平均成绩大于60分的同学的学号和平均成绩"><a href="#2-查询平均成绩大于60分的同学的学号和平均成绩" class="headerlink" title="2. 查询平均成绩大于60分的同学的学号和平均成绩"></a>2. 查询平均成绩大于60分的同学的学号和平均成绩</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT `S#`, avg(score) AS avg_score FROM SC GROUP BY `S#` HAVING avg(score)&gt;60;</span><br></pre></td></tr></table></figure>
<h4 id="3-查询所有同学的学号、姓名、选课数、总成绩"><a href="#3-查询所有同学的学号、姓名、选课数、总成绩" class="headerlink" title="3. 查询所有同学的学号、姓名、选课数、总成绩"></a>3. 查询所有同学的学号、姓名、选课数、总成绩</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT Student.`S#`,Student.Sname ,e1.sum_of_course , e1.sum_of_score FROM </span><br><span class="line">(SELECT `S#`,count(`C#`) as sum_of_course, sum(score) as sum_of_score </span><br><span class="line">FROM SC GROUP BY `S#`) </span><br><span class="line">AS e1 </span><br><span class="line">LEFT JOIN Student ON Student.`S#`=e1.`S#`;</span><br></pre></td></tr></table></figure>
<h4 id="4-查询姓‘李’的老师的个数"><a href="#4-查询姓‘李’的老师的个数" class="headerlink" title="4. 查询姓‘李’的老师的个数"></a>4. 查询姓‘李’的老师的个数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT count(DISTINCT(Tname))  FROM Teacher WHERE Tname LIKE &apos;李%&apos;;</span><br></pre></td></tr></table></figure>
<h4 id="5-查询没有学过“叶平”老师可的同学的学号、姓名"><a href="#5-查询没有学过“叶平”老师可的同学的学号、姓名" class="headerlink" title="5. 查询没有学过“叶平”老师可的同学的学号、姓名"></a>5. 查询没有学过“叶平”老师可的同学的学号、姓名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT `S#`, Sname FROM Student WHERE `S#` </span><br><span class="line">NOT  IN </span><br><span class="line">(SELECT `S#` FROM SC WHERE `C#` </span><br><span class="line"> IN</span><br><span class="line"> (SELECT `C#` FROM Course WHERE `T#` </span><br><span class="line">  IN</span><br><span class="line">  (SELECT `T#` FROM Teacher WHERE Tname = &apos;叶平&apos;)));</span><br></pre></td></tr></table></figure>
<h4 id="6-查询学过“叶平”老师所教的所有课的同学的学号、姓名"><a href="#6-查询学过“叶平”老师所教的所有课的同学的学号、姓名" class="headerlink" title="6. 查询学过“叶平”老师所教的所有课的同学的学号、姓名"></a>6. 查询学过“叶平”老师所教的所有课的同学的学号、姓名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select `S#`,Sname   from Student    </span><br><span class="line">where `S#` in (select `S#` from SC ,Course ,Teacher </span><br><span class="line">where SC.`C#`=Course.`C#` and Teacher.`T#`=Course.`T#` </span><br><span class="line">and Teacher.Tname=&apos;叶平&apos; group by `S#` </span><br><span class="line">having count(SC.`C#`)=(select count(`C#`) from Course,Teacher  </span><br><span class="line">where Teacher.`T#`=Course.`T#` and Tname=&apos;叶平&apos;));</span><br></pre></td></tr></table></figure>
<h4 id="7、查询学过“011”并且也学过编号“002”课程的同学的学号、姓名"><a href="#7、查询学过“011”并且也学过编号“002”课程的同学的学号、姓名" class="headerlink" title="7、查询学过“011”并且也学过编号“002”课程的同学的学号、姓名"></a>7、查询学过“011”并且也学过编号“002”课程的同学的学号、姓名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select Student.`S#`,Student.Sname </span><br><span class="line">from Student,SC where Student.`S#`=SC.`S#` </span><br><span class="line">and SC.`C#`=&apos;001&apos;and </span><br><span class="line">exists( Select * from SC as SC_2 where SC_2.`S#`=SC.`S#` and SC_2.`C#`=&apos;002&apos;);</span><br></pre></td></tr></table></figure>
<h4 id="8、查询课程编号“002”的成绩比课程编号“001”课程低的所有同学的学号、姓名"><a href="#8、查询课程编号“002”的成绩比课程编号“001”课程低的所有同学的学号、姓名" class="headerlink" title="8、查询课程编号“002”的成绩比课程编号“001”课程低的所有同学的学号、姓名"></a>8、查询课程编号“002”的成绩比课程编号“001”课程低的所有同学的学号、姓名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Select `S#`,`Sname` </span><br><span class="line">from (select Student.`S#`,Student.`Sname`,score ,</span><br><span class="line">(select score from SC SC_2 where SC_2.`S#`=Student.`S#` and SC_2.`C#`=&apos;002&apos;) score2    </span><br><span class="line">from Student,SC </span><br><span class="line">where Student.`S#`=SC.`S#` and `C#`=&apos;001&apos;) S_2 </span><br><span class="line">where score2 &lt; score;</span><br></pre></td></tr></table></figure>
<h4 id="9-查询所有课程成绩小于60的同学的学号、姓名"><a href="#9-查询所有课程成绩小于60的同学的学号、姓名" class="headerlink" title="9. 查询所有课程成绩小于60的同学的学号、姓名"></a>9. 查询所有课程成绩小于60的同学的学号、姓名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select Student.`S#`,Student.`Sname` from </span><br><span class="line">Student,</span><br><span class="line">(select e1.`S#` from (select `S#`,max(score) max_score from SC group by `S#`) e1 </span><br><span class="line">where e1.max_score&lt;60) e2</span><br><span class="line">where e2.`S#`= Student.`S#`;</span><br></pre></td></tr></table></figure>
<h4 id="10、查询没有学全所有课的同学的学号、姓名"><a href="#10、查询没有学全所有课的同学的学号、姓名" class="headerlink" title="10、查询没有学全所有课的同学的学号、姓名"></a>10、查询没有学全所有课的同学的学号、姓名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select Student.`S#`,Student.`Sname` from </span><br><span class="line">Student,SC</span><br><span class="line">where Student.`S#`=SC.`S#`</span><br><span class="line">group by Student.`S#`,Student.`Sname`</span><br><span class="line">having count(`C#`)&lt;(select count(`C#`) from Course);</span><br></pre></td></tr></table></figure>
<h4 id="11、查询至少有一门课与学号为“1001”同学所学相同的同学的学号和姓名"><a href="#11、查询至少有一门课与学号为“1001”同学所学相同的同学的学号和姓名" class="headerlink" title="11、查询至少有一门课与学号为“1001”同学所学相同的同学的学号和姓名"></a>11、查询至少有一门课与学号为“1001”同学所学相同的同学的学号和姓名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select distinct(Student.`S#`),Student.`Sname`</span><br><span class="line">from om Student,SC  </span><br><span class="line">where Student.`S#`=SC.`S#` </span><br><span class="line">and `C#` in (sselect `C#` from SC where `S#`=&apos;1001&apos;);</span><br></pre></td></tr></table></figure>
<h4 id="12-查询至少学过学号为“001”同学所有一门课的其他同学学号和姓名"><a href="#12-查询至少学过学号为“001”同学所有一门课的其他同学学号和姓名" class="headerlink" title="12. 查询至少学过学号为“001”同学所有一门课的其他同学学号和姓名"></a>12. 查询至少学过学号为“001”同学所有一门课的其他同学学号和姓名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select distinct(Student.`S#`),Student.`Sname` </span><br><span class="line">from Student,SC </span><br><span class="line">where Student.`S#`=SC.`S#` </span><br><span class="line">and `C#` in (select `C#` from SC where `S#`=&apos;1001&apos;) </span><br><span class="line">and Student.`S#`&lt;&gt; &apos;1001&apos;;</span><br></pre></td></tr></table></figure>
<h4 id="13-把“SC”表中“叶平”老师教的课的成绩都更改为此课程的平均成绩："><a href="#13-把“SC”表中“叶平”老师教的课的成绩都更改为此课程的平均成绩：" class="headerlink" title="13. 把“SC”表中“叶平”老师教的课的成绩都更改为此课程的平均成绩："></a>13. 把“SC”表中“叶平”老师教的课的成绩都更改为此课程的平均成绩：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Update SC Set Score=(Select Avg(s2_Score) From SC s2 Where s2.`C#`=sc.`C#`)  </span><br><span class="line">Where `C#` IN</span><br><span class="line">(Select `c#` From SC cs INNER JOIN Teacher tc ON cs.`T#`=tc.`T#` WHERE `Tname` =&apos;叶平&apos;)</span><br></pre></td></tr></table></figure>
<h4 id="14-查询和“1002”号的同学学习的课程完全相同的其他同学学号和姓名"><a href="#14-查询和“1002”号的同学学习的课程完全相同的其他同学学号和姓名" class="headerlink" title="14. 查询和“1002”号的同学学习的课程完全相同的其他同学学号和姓名"></a>14. 查询和“1002”号的同学学习的课程完全相同的其他同学学号和姓名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select `S#`, `Sname` from Student </span><br><span class="line">where `S#` </span><br><span class="line">in (select `S#` from SC where `C#` in (select `C#` from SC where `S#`=&apos;1002&apos;) </span><br><span class="line">group by `S#` </span><br><span class="line">having count(*) = (select count(`C#`) from SC where `S#`=&apos;1002&apos;));</span><br></pre></td></tr></table></figure>
<h4 id="15-删除学习“叶平”老师课的SC表记录"><a href="#15-删除学习“叶平”老师课的SC表记录" class="headerlink" title="15. 删除学习“叶平”老师课的SC表记录"></a>15. 删除学习“叶平”老师课的SC表记录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from SC where SC.`C#` = (select Course.`C#` from Course, Teacher where Course.`T#`=Teacher.`T#` and Teacher.`Tname`= &apos;叶平&apos;);</span><br></pre></td></tr></table></figure>
<h4 id="16-向SC表中插入一些记录，这些记录要求符合以下条件：没有上过编号“003”课程的同学学号、002号课的平均成绩"><a href="#16-向SC表中插入一些记录，这些记录要求符合以下条件：没有上过编号“003”课程的同学学号、002号课的平均成绩" class="headerlink" title="16. 向SC表中插入一些记录，这些记录要求符合以下条件：没有上过编号“003”课程的同学学号、002号课的平均成绩"></a>16. 向SC表中插入一些记录，这些记录要求符合以下条件：没有上过编号“003”课程的同学学号、002号课的平均成绩</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into SC select `S#`, &apos;002&apos;, (select avg(score) from SC where `C#`=&apos;002&apos;) from Student where `S#` not in (select `S#` from SC where `C#`=&apos;003&apos;);</span><br></pre></td></tr></table></figure>
<h4 id="17-按平均成绩从高到低显示所有学生的“数据库”、“企业管理”、“英语”三门的课程成绩，按如下形式显示：学生ID，数据库，企业管理，英语，有效课程数，有效平均分"><a href="#17-按平均成绩从高到低显示所有学生的“数据库”、“企业管理”、“英语”三门的课程成绩，按如下形式显示：学生ID，数据库，企业管理，英语，有效课程数，有效平均分" class="headerlink" title="17. 按平均成绩从高到低显示所有学生的“数据库”、“企业管理”、“英语”三门的课程成绩，按如下形式显示：学生ID，数据库，企业管理，英语，有效课程数，有效平均分"></a>17. 按平均成绩从高到低显示所有学生的“数据库”、“企业管理”、“英语”三门的课程成绩，按如下形式显示：学生ID，数据库，企业管理，英语，有效课程数，有效平均分</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `S#` &apos;学生ID&apos;,(select score from SC,Course where SC.`S#`=t.`S#` and SC.`C#`=Course.`C#` and Course.`Cname`=&apos;数据库&apos;) &apos;数据库&apos;,(select score from SC,Course where SC.`ere SC.`S#`=t.`S#` and SC.`C#`=Course.`C#` and Course.`Cname`=&apos;企业管理&apos;) &apos;企业管理&apos;, (select score from SC,Course where SC.`S#`=t.`S#` and SC.`C#`=Course.`C#` and Course.a`Cname`=&apos;英语&apos;) &apos;英语&apos;, count（*） &apos;有效课程&apos;， avg(t.`score`) &apos;平均成绩&apos; from SC t  group by `S#` order by avg(t.score)</span><br></pre></td></tr></table></figure>
<h4 id="18、查询各科成绩最高和最低的分：-以如下的形式显示：课程ID，最高分，最低分"><a href="#18、查询各科成绩最高和最低的分：-以如下的形式显示：课程ID，最高分，最低分" class="headerlink" title="18、查询各科成绩最高和最低的分： 以如下的形式显示：课程ID，最高分，最低分"></a>18、查询各科成绩最高和最低的分： 以如下的形式显示：课程ID，最高分，最低分</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select Course.`C#` &apos;课程ID&apos;,  e1.score &apos;最高分&apos;, e2.score &apos;最低分&apos; from Course,(select `C#`,max(score) from SC group by `C#`) e1，Course(select `C#`,min(score) from SC group by `C#`) e2 where Course.`C#`=e1.`C#`=e2.`C#`;</span><br></pre></td></tr></table></figure>
<h4 id="19、按各科平均成绩从低到高和及格率的百分数从高到低顺序"><a href="#19、按各科平均成绩从低到高和及格率的百分数从高到低顺序" class="headerlink" title="19、按各科平均成绩从低到高和及格率的百分数从高到低顺序"></a>19、按各科平均成绩从低到高和及格率的百分数从高到低顺序</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select SC.`C#`,avg(SC.score),S2.pass from </span><br><span class="line">SC ,(select e1.`C#`, c1/c2 &apos;pass&apos; from (select `C#`,count(`S#`) c1 </span><br><span class="line">from SC where score&gt;60 group by `C#`) e1,(select `C#`,count(`S#`) c2 from SC  group by `C#`) e2 where e1.`C#`=e2.`C#`) S2 where SC.`C#` = S2.`C#` </span><br><span class="line">group by SC.`C#` order by avg(SC.score) asc,pass desc;</span><br></pre></td></tr></table></figure>
<h4 id="20、查询如下课程平均成绩和及格率的百分数-用”1行”显示-企业管理（001），马克思（002），OO-amp-UML-（003），数据库（004）："><a href="#20、查询如下课程平均成绩和及格率的百分数-用”1行”显示-企业管理（001），马克思（002），OO-amp-UML-（003），数据库（004）：" class="headerlink" title="20、查询如下课程平均成绩和及格率的百分数(用”1行”显示): 企业管理（001），马克思（002），OO&amp;UML （003），数据库（004）："></a>20、查询如下课程平均成绩和及格率的百分数(用”1行”显示): 企业管理（001），马克思（002），OO&amp;UML （003），数据库（004）：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT SUM(CASE WHEN `C#` =&apos;001&apos; THEN score ELSE 0 END)/SUM(CASE `C#` WHEN &apos;001&apos; THEN 1 ELSE 0 END) AS 企业管理平均分 </span><br><span class="line">       ,100 * SUM(CASE WHEN `C#` = &apos;001&apos; AND score &gt;= 60 THEN 1 ELSE 0 END)/SUM(CASE WHEN `C#` = &apos;001&apos; THEN 1 ELSE 0 END) AS 企业管理及格百分数 </span><br><span class="line">       ,SUM(CASE WHEN `C#` = &apos;002&apos; THEN score ELSE 0 END)/SUM(CASE `C#` WHEN &apos;002&apos; THEN 1 ELSE 0 END) AS 马克思平均分 </span><br><span class="line">       ,100 * SUM(CASE WHEN `C#` = &apos;002&apos; AND score &gt;= 60 THEN 1 ELSE 0 END)/SUM(CASE WHEN `C#` = &apos;002&apos; THEN 1 ELSE 0 END) AS 马克思及格百分数 </span><br><span class="line">       ,SUM(CASE WHEN `C#` = &apos;003&apos; THEN score ELSE 0 END)/SUM(CASE `C#` WHEN &apos;003&apos; THEN 1 ELSE 0 END) AS UML平均分 </span><br><span class="line">       ,100 * SUM(CASE WHEN `C#` = &apos;003&apos; AND score &gt;= 60 THEN 1 ELSE 0 END)/SUM(CASE WHEN `C#` = &apos;003&apos; THEN 1 ELSE 0 END) AS UML及格百分数 </span><br><span class="line">       ,SUM(CASE WHEN `C#` = &apos;004&apos; THEN score ELSE 0 END)/SUM(CASE `C#` WHEN &apos;004&apos; THEN 1 ELSE 0 END) AS 数据库平均分 </span><br><span class="line">       ,100 * SUM(CASE WHEN `C#` = &apos;004&apos; AND score &gt;= 60 THEN 1 ELSE 0 END)/SUM(CASE WHEN `C#` = &apos;004&apos; THEN 1 ELSE 0 END) AS 数据库及格百分数 </span><br><span class="line"> FROM SC</span><br></pre></td></tr></table></figure>
<h4 id="21、查询不同老师所教不同课程平均分从高到低显示："><a href="#21、查询不同老师所教不同课程平均分从高到低显示：" class="headerlink" title="21、查询不同老师所教不同课程平均分从高到低显示："></a>21、查询不同老师所教不同课程平均分从高到低显示：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT max(Z.T#) AS 教师ID,MAX(Z.Tname) AS 教师姓名,C.C# AS 课程ＩＤ,MAX(C.Cname) AS 课程名称,AVG(Score) AS 平均成绩 </span><br><span class="line">    FROM SC AS T,Course AS C ,Teacher AS Z </span><br><span class="line">    where T.C#=C.C# and C.T#=Z.T# </span><br><span class="line">  GROUP BY C.C# </span><br><span class="line">  ORDER BY AVG(Score) DESC</span><br></pre></td></tr></table></figure>
<h4 id="22、查询如下课程成绩第3名到第6名的学生成绩单：企业管理-001-，马克思-002-，UML-003-，数据库-004"><a href="#22、查询如下课程成绩第3名到第6名的学生成绩单：企业管理-001-，马克思-002-，UML-003-，数据库-004" class="headerlink" title="22、查询如下课程成绩第3名到第6名的学生成绩单：企业管理(001)，马克思(002)，UML(003)，数据库(004)"></a>22、查询如下课程成绩第3名到第6名的学生成绩单：企业管理(001)，马克思(002)，UML(003)，数据库(004)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">SELECT  DISTINCT top 3 </span><br><span class="line">  SC.`S#` As &apos;学生学号&apos;, </span><br><span class="line">    Student.Sname AS &apos;学生姓名&apos; , </span><br><span class="line">  T1.score AS &apos;企业管理&apos;, </span><br><span class="line">  T2.score AS &apos;马克思&apos;, </span><br><span class="line">  T3.score AS &apos;UML&apos;, </span><br><span class="line">  T4.score AS &apos;数据库&apos;, </span><br><span class="line">  ISNULL(T1.score,0) + ISNULL(T2.score,0) + ISNULL(T3.score,0) + ISNULL(T4.score,0) as 总分 </span><br><span class="line">  FROM Student,SC  LEFT JOIN SC AS T1 </span><br><span class="line">                  ON SC.`S#` = T1.`S#` AND T1.`C#` = &apos;001&apos; </span><br><span class="line">        LEFT JOIN SC AS T2 </span><br><span class="line">                  ON SC.`S#` = T2.`S#` AND T2.`C#` = &apos;002&apos; </span><br><span class="line">        LEFT JOIN SC AS T3 </span><br><span class="line">                  ON SC.`S#` = T3.`S#` AND T3.`C#` = &apos;003&apos; </span><br><span class="line">        LEFT JOIN SC AS T4 </span><br><span class="line">                  ON SC.`S#` = T4.`S#` AND T4.`C#` = &apos;004&apos; </span><br><span class="line">  WHERE student.`S#`=SC.`S#` and </span><br><span class="line">  ISNULL(T1.score,0) + ISNULL(T2.score,0) + ISNULL(T3.score,0) + ISNULL(T4.score,0) </span><br><span class="line">  NOT IN </span><br><span class="line">  (SELECT </span><br><span class="line">        DISTINCT </span><br><span class="line">        TOP 15 WITH TIES </span><br><span class="line">        ISNULL(T1.score,0) + ISNULL(T2.score,0) + ISNULL(T3.score,0) + ISNULL(T4.score,0) </span><br><span class="line">  FROM sc </span><br><span class="line">        LEFT JOIN sc AS T1 </span><br><span class="line">                  ON sc.`S#` = T1.`S#` AND T1.`C#` = &apos;k1&apos; </span><br><span class="line">        LEFT JOIN sc AS T2 </span><br><span class="line">                  ON sc.`S#` = T2.`S#` AND T2.`C#` = &apos;k2&apos; </span><br><span class="line">        LEFT JOIN sc AS T3 </span><br><span class="line">                  ON sc.`S#` = T3.`S#` AND T3.`C#` = &apos;k3&apos; </span><br><span class="line">        LEFT JOIN sc AS T4 </span><br><span class="line">                  ON sc.`S#` = T4.`S#` AND T4.`C#` = &apos;k4&apos; </span><br><span class="line">  ORDER BY ISNULL(T1.score,0) + ISNULL(T2.score,0) + ISNULL(T3.score,0) + ISNULL(T4.score,0) DESC);</span><br></pre></td></tr></table></figure>
<h4 id="23、统计下列各科成绩，各分数段人数：课程ID，课程名称，-100-85-85-70-70-60-小于60-："><a href="#23、统计下列各科成绩，各分数段人数：课程ID，课程名称，-100-85-85-70-70-60-小于60-：" class="headerlink" title="23、统计下列各科成绩，各分数段人数：课程ID，课程名称，[100-85],[85-70],[70-60],[ 小于60] ："></a>23、统计下列各科成绩，各分数段人数：课程ID，课程名称，[100-85],[85-70],[70-60],[ 小于60] ：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select SC.`C#` as &apos;课程ID&apos;, Course.`Cname` as &apos;课程名称&apos;, </span><br><span class="line">sum(case when score between 85 and 100 then 1 else 0 end) as &apos;[100-85]&apos;,</span><br><span class="line">sum(case when score between 70 and 85 then 1 else 0 end) as &apos;[85-70]&apos;,</span><br><span class="line">sum(case when score between 60 and 70 then 1 else 0 end) as &apos;[70-60]&apos;,</span><br><span class="line">sum(case when score &lt; 60 then 1 else 0 end) as &apos;[小于60]&apos;</span><br><span class="line">from SC, Course </span><br><span class="line">where SC.`C#`=Course.`C#`</span><br><span class="line">group by SC.`C#`,Cname;</span><br></pre></td></tr></table></figure>
<h4 id="24、查询学生平均成绩及其名次："><a href="#24、查询学生平均成绩及其名次：" class="headerlink" title="24、查询学生平均成绩及其名次："></a>24、查询学生平均成绩及其名次：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select 1+(select count(distinct &apos;平均成绩&apos;) from (select `S#`, avg(score) as &apos;平均成绩&apos; from SC group by `S#`) as T1</span><br><span class="line">where &apos;平均成绩&apos;&gt;T2.`平均成绩`) as &apos;名次&apos;,</span><br><span class="line">from (select `S#`,avg(score) &apos;平均成绩&apos; from SC group by `S#`) as T2</span><br><span class="line">order by &apos;平均成绩&apos; desc;</span><br></pre></td></tr></table></figure>
<h4 id="25、查询各科成绩前三名的记录（不考虑成绩并列情况）："><a href="#25、查询各科成绩前三名的记录（不考虑成绩并列情况）：" class="headerlink" title="25、查询各科成绩前三名的记录（不考虑成绩并列情况）："></a>25、查询各科成绩前三名的记录（不考虑成绩并列情况）：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(select * from SC where `C#`=&apos;001&apos; order by score desc limit 3) union all  (select * from SC where `C#`=&apos;002&apos; order by score desc limit 3) union all (select * from SC where `C#`=&apos;003&apos; order by score desc limit 3) union all (select * from SC where `C#`=&apos;004&apos; order by score desc limit 3) union all (select * from SC where `C#`=&apos;005&apos; ordeer by score desc limit 3);</span><br><span class="line">      </span><br><span class="line">     select S1.`S#`,S1.`C#` from SC S1 left join SC S2 on S1.`C#`=S2.`C#` and S1.score&lt;S2.score group by S1.`S#`,S1.`C#`,S1.`score` having count(S2.`S#`)&lt;3</span><br><span class="line">     order by S1.`C#`,S1.`score` desc;</span><br></pre></td></tr></table></figure>
<h4 id="26、查询每门课程被选修的学生数："><a href="#26、查询每门课程被选修的学生数：" class="headerlink" title="26、查询每门课程被选修的学生数："></a>26、查询每门课程被选修的学生数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `C#`,count(`S#`) from SC group by `C#`;</span><br></pre></td></tr></table></figure>
<h4 id="27、查询出只选修一门课程的全部学生的学号和姓名："><a href="#27、查询出只选修一门课程的全部学生的学号和姓名：" class="headerlink" title="27、查询出只选修一门课程的全部学生的学号和姓名："></a>27、查询出只选修一门课程的全部学生的学号和姓名：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select Student.`S#`, Student.`Sname` from Student, (select `S#` from SC  group by `S#` having count(`C#`)=1) e where Student.`S#`=e.`S#`;</span><br></pre></td></tr></table></figure>
<h4 id="28、查询男生、女生人数："><a href="#28、查询男生、女生人数：" class="headerlink" title="28、查询男生、女生人数："></a>28、查询男生、女生人数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select e1.M as &apos;男生人数&apos;,e2.F as &apos;女生人数&apos; from (select count(`S#`) as M from Student group by `Ssex` having `Ssex`=&apos;M&apos; ) e1,</span><br><span class="line">(select count(`S#`) as F from Student group by `Ssex` having `Ssex`=&apos;F&apos;) e2;</span><br></pre></td></tr></table></figure>
<h4 id="29、查询姓“张”的学生名单："><a href="#29、查询姓“张”的学生名单：" class="headerlink" title="29、查询姓“张”的学生名单："></a>29、查询姓“张”的学生名单：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `Sname` from Student where `Sname` like &apos;张%&apos;;</span><br></pre></td></tr></table></figure>
<h4 id="30、查询同名同姓的学生名单，并统计同名人数："><a href="#30、查询同名同姓的学生名单，并统计同名人数：" class="headerlink" title="30、查询同名同姓的学生名单，并统计同名人数："></a>30、查询同名同姓的学生名单，并统计同名人数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `Sname`,count(*) from Student group by `Sname` having count(*)&gt;1;</span><br></pre></td></tr></table></figure>
<h4 id="31、1981年出生的学生名单（注：student表中sage列的类型是datetime）"><a href="#31、1981年出生的学生名单（注：student表中sage列的类型是datetime）" class="headerlink" title="31、1981年出生的学生名单（注：student表中sage列的类型是datetime）:"></a>31、1981年出生的学生名单（注：student表中sage列的类型是datetime）:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `Sname` convert(char(11), DATEPART(year, Sage)) as age from Student where age = &apos;1981&apos;;</span><br></pre></td></tr></table></figure>
<h4 id="32、查询平均成绩大于85的所有学生的学号、姓名和平均成绩："><a href="#32、查询平均成绩大于85的所有学生的学号、姓名和平均成绩：" class="headerlink" title="32、查询平均成绩大于85的所有学生的学号、姓名和平均成绩："></a>32、查询平均成绩大于85的所有学生的学号、姓名和平均成绩：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select Student.`S#`,Student.`Sname`,avg(SC.score) from Student,SC where Student.`S#`=SC.`S#` group by SC.`S#` having avg(SC.score)&gt;85;</span><br></pre></td></tr></table></figure>
<h4 id="33、查询每门课程的平均成绩，结果按平均成绩升序排序，平均成绩相同时，按课程号降序排列："><a href="#33、查询每门课程的平均成绩，结果按平均成绩升序排序，平均成绩相同时，按课程号降序排列：" class="headerlink" title="33、查询每门课程的平均成绩，结果按平均成绩升序排序，平均成绩相同时，按课程号降序排列："></a>33、查询每门课程的平均成绩，结果按平均成绩升序排序，平均成绩相同时，按课程号降序排列：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `C#`, avg(score) from SC group by `C#` order by avg(score) asc, `C#` desc;</span><br></pre></td></tr></table></figure>
<h4 id="34、查询课程名称为“数据库”，且分数低于60的学生名字和分数："><a href="#34、查询课程名称为“数据库”，且分数低于60的学生名字和分数：" class="headerlink" title="34、查询课程名称为“数据库”，且分数低于60的学生名字和分数："></a>34、查询课程名称为“数据库”，且分数低于60的学生名字和分数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select Student.`Sname`,SC.`score` from Student, SC, Course where Course.`Cname`=&apos;数据库&apos; and Course.`C#`=SC.`C#` and Student.`S#`=SC.`S#` and SC.`score`&lt;60;</span><br></pre></td></tr></table></figure>
<h4 id="35、查询所有学生的选课情况："><a href="#35、查询所有学生的选课情况：" class="headerlink" title="35、查询所有学生的选课情况："></a>35、查询所有学生的选课情况：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select SC.`S#`,SC.`C#`,Sname,Cname from SC, Student,Course where Course.`C#`=SC.`C#` and SC.`S#`=Student.`S#`;</span><br></pre></td></tr></table></figure>
<h4 id="36、查询任何一门课程成绩在70分以上的姓名、课程名称和分数："><a href="#36、查询任何一门课程成绩在70分以上的姓名、课程名称和分数：" class="headerlink" title="36、查询任何一门课程成绩在70分以上的姓名、课程名称和分数："></a>36、查询任何一门课程成绩在70分以上的姓名、课程名称和分数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select distinct `Sname`, `Cname`, `score` from Student, Course, SC where Course.`C#`=SC.`C#` and SC.`S#`=Student.`S#` and score&gt;70;</span><br></pre></td></tr></table></figure>
<h4 id="37、查询不及格的课程，并按课程号从大到小的排列："><a href="#37、查询不及格的课程，并按课程号从大到小的排列：" class="headerlink" title="37、查询不及格的课程，并按课程号从大到小的排列："></a>37、查询不及格的课程，并按课程号从大到小的排列：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select SC.`C#`, `Cname` from Course, SC where Course.`C#`=SC.`C#` and SC.score&lt;60;</span><br></pre></td></tr></table></figure>
<h4 id="38、查询课程编号为“003”且课程成绩在80分以上的学生的学号和姓名："><a href="#38、查询课程编号为“003”且课程成绩在80分以上的学生的学号和姓名：" class="headerlink" title="38、查询课程编号为“003”且课程成绩在80分以上的学生的学号和姓名："></a>38、查询课程编号为“003”且课程成绩在80分以上的学生的学号和姓名：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select Student.`S#`,`Sname` from SC, Student, Course where Course.`C#`=SC.`C#` and Student.`S#`=SC.`S#` and Course.`C#`=&apos;003&apos; and score&gt;80;</span><br></pre></td></tr></table></figure>
<h4 id="39、求选了课程的学生人数："><a href="#39、求选了课程的学生人数：" class="headerlink" title="39、求选了课程的学生人数："></a>39、求选了课程的学生人数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select count(`S#`) from SC group by `S#` having count(`C#`)&gt;1;</span><br><span class="line">--</span><br><span class="line">select count(*) from SC;</span><br></pre></td></tr></table></figure>
<h4 id="40、查询选修“叶平”老师所授课程的学生中，成绩最高的学生姓名及其成绩："><a href="#40、查询选修“叶平”老师所授课程的学生中，成绩最高的学生姓名及其成绩：" class="headerlink" title="40、查询选修“叶平”老师所授课程的学生中，成绩最高的学生姓名及其成绩："></a>40、查询选修“叶平”老师所授课程的学生中，成绩最高的学生姓名及其成绩：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `Sname`,score from Student, SC, Course, Teacher where `Tname`=&apos;叶平&apos; and Teacher.`T#`=Course.`T#` and Course.`C#`= SC.`C#` and Student.`S#`=SC.`S#` and SC.sore=(select max(score) from SC where `C#`=Course.`C#`);</span><br></pre></td></tr></table></figure>
<h4 id="41、查询各个课程及相应的选修人数："><a href="#41、查询各个课程及相应的选修人数：" class="headerlink" title="41、查询各个课程及相应的选修人数："></a>41、查询各个课程及相应的选修人数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `C#`, count(`S#`) from SC group by `C#`;</span><br></pre></td></tr></table></figure>
<h4 id="42、查询不同课程成绩相同的学生和学号、课程号、学生成绩："><a href="#42、查询不同课程成绩相同的学生和学号、课程号、学生成绩：" class="headerlink" title="42、查询不同课程成绩相同的学生和学号、课程号、学生成绩："></a>42、查询不同课程成绩相同的学生和学号、课程号、学生成绩：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select distinct SC.`S#`,SC.`C#`,SC.`score` from SC,(select * from SC) S2 where SC.`S#`=S2.`S#` and SC.`C#`&lt;&gt;S2.`C#` and SC.`score`=S2.`score`;</span><br><span class="line">--</span><br><span class="line">select distinct a.`S#`, a.`score` from SC a, SC  b where a.score=b.score and a.`C#`&lt;&gt;b.`C#`;</span><br></pre></td></tr></table></figure>
<h4 id="43、查询每门课程成绩最好的前两名："><a href="#43、查询每门课程成绩最好的前两名：" class="headerlink" title="43、查询每门课程成绩最好的前两名："></a>43、查询每门课程成绩最好的前两名：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from SC where (select count(distinct(e1.score)) from SC e1 where e1.`C#`=SC.`C#` and e1.`score`&gt;SC.`score`)&lt;4;</span><br></pre></td></tr></table></figure>
<h4 id="44、统计每门课程的学生选修人数-超过10人的课程才统计-。要求输出课程号和选修人数，查询结果按人数降序排序，若人数相同，按课程号升序排序："><a href="#44、统计每门课程的学生选修人数-超过10人的课程才统计-。要求输出课程号和选修人数，查询结果按人数降序排序，若人数相同，按课程号升序排序：" class="headerlink" title="44、统计每门课程的学生选修人数(超过10人的课程才统计)。要求输出课程号和选修人数，查询结果按人数降序排序，若人数相同，按课程号升序排序："></a>44、统计每门课程的学生选修人数(超过10人的课程才统计)。要求输出课程号和选修人数，查询结果按人数降序排序，若人数相同，按课程号升序排序：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `C#`, count(`S#`) S1 from SC  group by `C#` having count(`S#`)&gt;10 order by S1 desc,`C#`;</span><br></pre></td></tr></table></figure>
<h4 id="45、检索至少选修两门课程的学生学号"><a href="#45、检索至少选修两门课程的学生学号" class="headerlink" title="45、检索至少选修两门课程的学生学号"></a>45、检索至少选修两门课程的学生学号</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `S#` from SC group by `S#` having count(`C#`)&gt;=2;</span><br></pre></td></tr></table></figure>
<h4 id="46、查询全部学生选修的课程和课程号和课程名："><a href="#46、查询全部学生选修的课程和课程号和课程名：" class="headerlink" title="46、查询全部学生选修的课程和课程号和课程名："></a>46、查询全部学生选修的课程和课程号和课程名：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select Student.`S#`,Student.`Sname`,Course.`Cname` from Student, Course, SC where Course.`C#`=SC.`C#` and Student.`S#`=SC.`S#`;</span><br></pre></td></tr></table></figure>
<h4 id="47、查询没学过”叶平”老师讲授的任一门课程的学生姓名："><a href="#47、查询没学过”叶平”老师讲授的任一门课程的学生姓名：" class="headerlink" title="47、查询没学过”叶平”老师讲授的任一门课程的学生姓名："></a>47、查询没学过”叶平”老师讲授的任一门课程的学生姓名：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select distinct `Sname` from Student,SC,Course,Teacher where Teacher.`Tname`&lt;&gt;&apos;叶平&apos; and Teacher.`T#`=Course.`T#` and Course.`C#`=SC.`C#` and SC.`S#`=Student.`S#`;</span><br></pre></td></tr></table></figure>
<h4 id="48、查询两门以上不及格课程的同学的学号以及其平均成绩"><a href="#48、查询两门以上不及格课程的同学的学号以及其平均成绩" class="headerlink" title="48、查询两门以上不及格课程的同学的学号以及其平均成绩"></a>48、查询两门以上不及格课程的同学的学号以及其平均成绩</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `S#`,avg(score) avg_score from SC where `S#` in (select `S#` from SC where score&lt;60 having count(*)&gt;2)group by `S#`;</span><br></pre></td></tr></table></figure>
<h4 id="49、检索“004”课程分数小于60，按分数降序排列的同学学号："><a href="#49、检索“004”课程分数小于60，按分数降序排列的同学学号：" class="headerlink" title="49、检索“004”课程分数小于60，按分数降序排列的同学学号："></a>49、检索“004”课程分数小于60，按分数降序排列的同学学号：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `S#` from SC where `C#`=&apos;004&apos; and score&lt;60 order by score desc;</span><br></pre></td></tr></table></figure>
<h4 id="50、删除“002”同学的“001”课程的成绩："><a href="#50、删除“002”同学的“001”课程的成绩：" class="headerlink" title="50、删除“002”同学的“001”课程的成绩："></a>50、删除“002”同学的“001”课程的成绩：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from SC where `S#`=&apos;002&apos; and `C#`=001;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/01/白夜行/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yfchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yfchen's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/01/白夜行/" itemprop="url">白夜行</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-01T21:26:13+08:00">
                2018-02-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="白夜行读书分享"><a href="#白夜行读书分享" class="headerlink" title="白夜行读书分享"></a>白夜行读书分享</h1><p><img src="D:\Google Download\白夜行.jpg" alt="白夜行"></p>
<h3 id="日本亚马逊、纪伊国屋、三省堂畅销排行第1名，韩国阿拉丁、YES24、教宝文库畅销排行第1名。同名日剧创造日本2007年度收视率记录。"><a href="#日本亚马逊、纪伊国屋、三省堂畅销排行第1名，韩国阿拉丁、YES24、教宝文库畅销排行第1名。同名日剧创造日本2007年度收视率记录。" class="headerlink" title="日本亚马逊、纪伊国屋、三省堂畅销排行第1名，韩国阿拉丁、YES24、教宝文库畅销排行第1名。同名日剧创造日本2007年度收视率记录。"></a>日本亚马逊、纪伊国屋、三省堂畅销排行第1名，韩国阿拉丁、YES24、教宝文库畅销排行第1名。同名日剧创造日本2007年度收视率记录。</h3><h4 id="“我的天空没有太阳，总是黑夜，但并不暗，因为有东西代替了太阳。虽然没有太阳那么明亮，但对于我来说已经足够。凭借这份光，我便能把黑夜当成白天。我从来就没有太阳，所以不怕失去。”-——雪穗"><a href="#“我的天空没有太阳，总是黑夜，但并不暗，因为有东西代替了太阳。虽然没有太阳那么明亮，但对于我来说已经足够。凭借这份光，我便能把黑夜当成白天。我从来就没有太阳，所以不怕失去。”-——雪穗" class="headerlink" title="“我的天空没有太阳，总是黑夜，但并不暗，因为有东西代替了太阳。虽然没有太阳那么明亮，但对于我来说已经足够。凭借这份光，我便能把黑夜当成白天。我从来就没有太阳，所以不怕失去。”                                                                                        ——雪穗"></a>“我的天空没有太阳，总是黑夜，但并不暗，因为有东西代替了太阳。虽然没有太阳那么明亮，但对于我来说已经足够。凭借这份光，我便能把黑夜当成白天。我从来就没有太阳，所以不怕失去。”                                                                                        ——雪穗</h4><h4 id="“只希望能手牵手在太阳下散步”-——亮司"><a href="#“只希望能手牵手在太阳下散步”-——亮司" class="headerlink" title="“只希望能手牵手在太阳下散步”                                                                        ——亮司"></a>“只希望能手牵手在太阳下散步”                                                                        ——亮司</h4><h3 id="作者简介"><a href="#作者简介" class="headerlink" title="作者简介"></a>作者简介</h3><h4 id="东野圭吾，日本作家。1958年生于大阪。1985年，以第31届江户川乱步奖获奖作品《放学后》出道，开始扬名立万。20年作品逾60部，几乎囊括日本所有大奖：1999年，《秘密》获第52届日本推理作家协会奖，入围第120届直木奖；2000年，《白夜行》入围第122届直木奖；2001年，《单恋》入围第125届直木奖；2004年，《幻夜》入围第131届直木奖；2006年的《嫌疑人X的献身》，获得第134届直木奖、第6届本格推理小说大奖。"><a href="#东野圭吾，日本作家。1958年生于大阪。1985年，以第31届江户川乱步奖获奖作品《放学后》出道，开始扬名立万。20年作品逾60部，几乎囊括日本所有大奖：1999年，《秘密》获第52届日本推理作家协会奖，入围第120届直木奖；2000年，《白夜行》入围第122届直木奖；2001年，《单恋》入围第125届直木奖；2004年，《幻夜》入围第131届直木奖；2006年的《嫌疑人X的献身》，获得第134届直木奖、第6届本格推理小说大奖。" class="headerlink" title="东野圭吾，日本作家。1958年生于大阪。1985年，以第31届江户川乱步奖获奖作品《放学后》出道，开始扬名立万。20年作品逾60部，几乎囊括日本所有大奖：1999年，《秘密》获第52届日本推理作家协会奖，入围第120届直木奖；2000年，《白夜行》入围第122届直木奖；2001年，《单恋》入围第125届直木奖；2004年，《幻夜》入围第131届直木奖；2006年的《嫌疑人X的献身》，获得第134届直木奖、第6届本格推理小说大奖。"></a><a href="https://baike.baidu.com/item/%E4%B8%9C%E9%87%8E%E5%9C%AD%E5%90%BE" target="_blank" rel="noopener">东野圭吾</a>，日本作家。1958年生于大阪。1985年，以第31届江户川乱步奖获奖作品《<a href="https://baike.baidu.com/item/%E6%94%BE%E5%AD%A6%E5%90%8E" target="_blank" rel="noopener">放学后</a>》出道，开始扬名立万。20年作品逾60部，几乎囊括日本所有大奖：1999年，《<a href="https://baike.baidu.com/item/%E7%A7%98%E5%AF%86" target="_blank" rel="noopener">秘密</a>》获第52届<a href="https://baike.baidu.com/item/%E6%97%A5%E6%9C%AC%E6%8E%A8%E7%90%86%E4%BD%9C%E5%AE%B6%E5%8D%8F%E4%BC%9A%E5%A5%96" target="_blank" rel="noopener">日本推理作家协会奖</a>，入围第120届直木奖；2000年，《白夜行》入围第122届直木奖；2001年，《<a href="https://baike.baidu.com/item/%E5%8D%95%E6%81%8B" target="_blank" rel="noopener">单恋</a>》入围第125届<a href="https://baike.baidu.com/item/%E7%9B%B4%E6%9C%A8%E5%A5%96" target="_blank" rel="noopener">直木奖</a>；2004年，《<a href="https://baike.baidu.com/item/%E5%B9%BB%E5%A4%9C" target="_blank" rel="noopener">幻夜</a>》入围第131届直木奖；2006年的《<a href="https://baike.baidu.com/item/%E5%AB%8C%E7%96%91%E4%BA%BAX%E7%9A%84%E7%8C%AE%E8%BA%AB" target="_blank" rel="noopener">嫌疑人X的献身</a>》，获得第134届直木奖、第6届本格推理小说大奖。</h4><p><img src="D:\Google Download\东野圭吾.jpg" alt="东野圭吾"></p>
<h3 id="事件表"><a href="#事件表" class="headerlink" title="事件表"></a>事件表</h3><table>
<thead>
<tr>
<th>年</th>
<th>月</th>
<th>雪穗</th>
<th>亮司</th>
</tr>
</thead>
<tbody>
<tr>
<td>1973</td>
<td>秋</td>
<td></td>
<td>其父被害</td>
</tr>
<tr>
<td>1974</td>
<td>5月</td>
<td>其母意外去世</td>
<td></td>
</tr>
<tr>
<td>1977</td>
<td></td>
<td>中学三年纪</td>
<td>摆平藤村都子</td>
</tr>
<tr>
<td>1980</td>
<td></td>
<td>高中二年级，伪装夕子</td>
<td>做披头生意，救友彦，做盗版软件</td>
</tr>
<tr>
<td>1981</td>
<td></td>
<td>高中毕业；加入大学舞社，拿到社费卡</td>
<td>拍川岛裸照；伪造信用卡；奈川美被杀，拿到两千万</td>
</tr>
<tr>
<td>1985</td>
<td>10月</td>
<td>大学毕业与高宫诚结婚</td>
<td></td>
</tr>
<tr>
<td></td>
<td>12.31</td>
<td></td>
<td>杀松浦，离开电脑店</td>
</tr>
<tr>
<td>1986</td>
<td>1月</td>
<td>投资股票</td>
<td>到Memorix工作</td>
</tr>
<tr>
<td></td>
<td>9月</td>
<td>工作，两个月后有自己的店</td>
<td></td>
</tr>
<tr>
<td>1988</td>
<td>4月初</td>
<td></td>
<td>跟踪三泽去上高尔夫课</td>
</tr>
<tr>
<td></td>
<td>4月中旬</td>
<td>给诚制造机会重遇三泽</td>
<td></td>
</tr>
<tr>
<td></td>
<td>7月</td>
<td>给诚的酒动手脚，设计离婚</td>
<td></td>
</tr>
<tr>
<td>1989</td>
<td></td>
<td>之前投资的两千万飙升</td>
<td></td>
</tr>
<tr>
<td>1991</td>
<td>4月</td>
<td></td>
<td>选中典子并暗中观察</td>
</tr>
<tr>
<td></td>
<td>5月</td>
<td></td>
<td>接触典子</td>
</tr>
<tr>
<td></td>
<td>6-7月</td>
<td>被一成委托的今枝调查</td>
<td>从Memorix离职后与典子同居，弄到l氯化钾</td>
</tr>
<tr>
<td></td>
<td>8.20</td>
<td></td>
<td>毒害今枝</td>
</tr>
<tr>
<td></td>
<td>9月</td>
<td></td>
<td>雪穗养母去世</td>
</tr>
<tr>
<td>1992</td>
<td>9月</td>
<td></td>
<td>与典子不告而别</td>
</tr>
<tr>
<td></td>
<td>10.10</td>
<td>与康晴结婚</td>
<td></td>
</tr>
<tr>
<td></td>
<td>12.25</td>
<td>大阪R&amp;Y开业</td>
<td>“她一次也没有回头”</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="男主——桐原亮司"><a href="#男主——桐原亮司" class="headerlink" title="男主——桐原亮司"></a>男主——桐原亮司</h3><p><img src="D:\Google Download\亮司.jpg" alt="亮司"></p>
<h4 id="桐原亮司扮演者——高良健吾"><a href="#桐原亮司扮演者——高良健吾" class="headerlink" title="桐原亮司扮演者——高良健吾"></a>桐原亮司扮演者——高良健吾</h4><h3 id="女主——西本-唐泽雪穗"><a href="#女主——西本-唐泽雪穗" class="headerlink" title="女主——西本/唐泽雪穗"></a>女主——西本/唐泽雪穗</h3><p><img src="D:\Google Download\唐泽雪穗.jpg" alt="唐泽雪穗"></p>
<h3 id="雪穗扮演者——堀北真希"><a href="#雪穗扮演者——堀北真希" class="headerlink" title="雪穗扮演者——堀北真希"></a>雪穗扮演者——堀北真希</h3><p><img src="D:\Google Download\白夜行人物关系图.jpg" alt="白夜行人物关系图"></p>
<h2 id="一-八个致死案件"><a href="#一-八个致死案件" class="headerlink" title="一. 八个致死案件"></a>一. 八个致死案件</h2><h3 id="1-桐原洋介"><a href="#1-桐原洋介" class="headerlink" title="1.桐原洋介"></a>1.桐原洋介</h3><h3 id="2-寺绮忠夫"><a href="#2-寺绮忠夫" class="headerlink" title="2.寺绮忠夫"></a>2.寺绮忠夫</h3><h3 id="3-西本文代"><a href="#3-西本文代" class="headerlink" title="3.西本文代"></a>3.西本文代</h3><h3 id="4-花冈夕子"><a href="#4-花冈夕子" class="headerlink" title="4.花冈夕子"></a>4.花冈夕子</h3><h3 id="5-奈江美"><a href="#5-奈江美" class="headerlink" title="5.奈江美"></a>5.奈江美</h3><h3 id="6-今枝直巳"><a href="#6-今枝直巳" class="headerlink" title="6.今枝直巳"></a>6.今枝直巳</h3><h3 id="7-松浦勇"><a href="#7-松浦勇" class="headerlink" title="7.松浦勇"></a>7.松浦勇</h3><h3 id="8-唐泽礼子"><a href="#8-唐泽礼子" class="headerlink" title="8.唐泽礼子"></a>8.唐泽礼子</h3><h2 id="二-三个性侵案"><a href="#二-三个性侵案" class="headerlink" title="二. 三个性侵案"></a>二. 三个性侵案</h2><h3 id="9-藤村都子"><a href="#9-藤村都子" class="headerlink" title="9.藤村都子"></a>9.藤村都子</h3><h3 id="10-川岛江利子"><a href="#10-川岛江利子" class="headerlink" title="10.川岛江利子"></a>10.川岛江利子</h3><h3 id="11-筱冢美佳"><a href="#11-筱冢美佳" class="headerlink" title="11.筱冢美佳"></a>11.筱冢美佳</h3><blockquote>
<h3 id="“他书写的恶往往不是凡俗的恶，而是一种提纯的，高智商的，有分寸的，肃穆的恶，那种恶最终会让人动容，和纯粹的善一样。”"><a href="#“他书写的恶往往不是凡俗的恶，而是一种提纯的，高智商的，有分寸的，肃穆的恶，那种恶最终会让人动容，和纯粹的善一样。”" class="headerlink" title="“他书写的恶往往不是凡俗的恶，而是一种提纯的，高智商的，有分寸的，肃穆的恶，那种恶最终会让人动容，和纯粹的善一样。”"></a>“他书写的恶往往不是凡俗的恶，而是一种提纯的，高智商的，有分寸的，肃穆的恶，那种恶最终会让人动容，和纯粹的善一样。”</h3><h3 id="——柏邦尼"><a href="#——柏邦尼" class="headerlink" title="——柏邦尼"></a>——柏邦尼</h3></blockquote>
<h3 id="整本书雪穗和亮司没有说一句话。"><a href="#整本书雪穗和亮司没有说一句话。" class="headerlink" title="整本书雪穗和亮司没有说一句话。"></a>整本书雪穗和亮司没有说一句话。</h3><h3 id="“她一次也没有回头”"><a href="#“她一次也没有回头”" class="headerlink" title="“她一次也没有回头”"></a>“她一次也没有回头”</h3><h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><h3 id="童年对一个人的影响有多大？大到你无法想象。"><a href="#童年对一个人的影响有多大？大到你无法想象。" class="headerlink" title="童年对一个人的影响有多大？大到你无法想象。"></a>童年对一个人的影响有多大？大到你无法想象。</h3><h3 id="雪穗和亮司的关系可以被称为爱情么？"><a href="#雪穗和亮司的关系可以被称为爱情么？" class="headerlink" title="雪穗和亮司的关系可以被称为爱情么？"></a>雪穗和亮司的关系可以被称为爱情么？</h3><h3 id="我们真的曾有机会造就不同的自己么？"><a href="#我们真的曾有机会造就不同的自己么？" class="headerlink" title="我们真的曾有机会造就不同的自己么？"></a>我们真的曾有机会造就不同的自己么？</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/27/Aibee面试感想/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yfchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yfchen's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/27/Aibee面试感想/" itemprop="url">Aibee面试感想</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-27T18:37:10+08:00">
                2018-01-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Aibee面试感想"><a href="#Aibee面试感想" class="headerlink" title="Aibee面试感想"></a>Aibee面试感想</h1><h4 id="上周四去一家叫做Aibee的公司去面试了，这家公司是前百度研究院院长林元庆博士创立的公司，合伙人有飞飞的丈夫Silvio-Savarese博士。关注这家公司是看新闻看到天使轮融资融到了1-65亿，下面就说一下面试的具体情况。"><a href="#上周四去一家叫做Aibee的公司去面试了，这家公司是前百度研究院院长林元庆博士创立的公司，合伙人有飞飞的丈夫Silvio-Savarese博士。关注这家公司是看新闻看到天使轮融资融到了1-65亿，下面就说一下面试的具体情况。" class="headerlink" title="上周四去一家叫做Aibee的公司去面试了，这家公司是前百度研究院院长林元庆博士创立的公司，合伙人有飞飞的丈夫Silvio Savarese博士。关注这家公司是看新闻看到天使轮融资融到了1.65亿，下面就说一下面试的具体情况。"></a>上周四去一家叫做Aibee的公司去面试了，这家公司是前百度研究院院长林元庆博士创立的公司，合伙人有飞飞的丈夫Silvio Savarese博士。关注这家公司是看新闻看到天使轮融资融到了1.65亿，下面就说一下面试的具体情况。</h4><h4 id="我是6：30下班之后过去的，到了就7点了，面试官直接面试。"><a href="#我是6：30下班之后过去的，到了就7点了，面试官直接面试。" class="headerlink" title="我是6：30下班之后过去的，到了就7点了，面试官直接面试。"></a>我是6：30下班之后过去的，到了就7点了，面试官直接面试。</h4><h4 id="1-面试官看着简历说选一个项目说说吧"><a href="#1-面试官看着简历说选一个项目说说吧" class="headerlink" title="1.面试官看着简历说选一个项目说说吧"></a>1.面试官看着简历说选一个项目说说吧</h4><h5 id="我就选取了我暑假参加联通的比赛项目说了一下比赛的基本情况，中间说到用xgboost来预测用户是否去迪士尼，基本说了一下项目的基本情况，说到了特征工程"><a href="#我就选取了我暑假参加联通的比赛项目说了一下比赛的基本情况，中间说到用xgboost来预测用户是否去迪士尼，基本说了一下项目的基本情况，说到了特征工程" class="headerlink" title="我就选取了我暑假参加联通的比赛项目说了一下比赛的基本情况，中间说到用xgboost来预测用户是否去迪士尼，基本说了一下项目的基本情况，说到了特征工程"></a>我就选取了我暑假参加联通的比赛项目说了一下比赛的基本情况，中间说到用xgboost来预测用户是否去迪士尼，基本说了一下项目的基本情况，说到了特征工程</h5><h4 id="2-特征工程是怎么做的？"><a href="#2-特征工程是怎么做的？" class="headerlink" title="2.特征工程是怎么做的？"></a>2.特征工程是怎么做的？</h4><h5 id="我就说我们创造了一些新的特征，比如像淘宝，天猫，京东和唯品会这些特征进行相加归为购物类特征。"><a href="#我就说我们创造了一些新的特征，比如像淘宝，天猫，京东和唯品会这些特征进行相加归为购物类特征。" class="headerlink" title="我就说我们创造了一些新的特征，比如像淘宝，天猫，京东和唯品会这些特征进行相加归为购物类特征。"></a>我就说我们创造了一些新的特征，比如像淘宝，天猫，京东和唯品会这些特征进行相加归为购物类特征。</h5><h4 id="3-你们就只是进行了简单的相加么，还有其他的特征工程么？问你还知道其他的特征工程的方法么？"><a href="#3-你们就只是进行了简单的相加么，还有其他的特征工程么？问你还知道其他的特征工程的方法么？" class="headerlink" title="3.你们就只是进行了简单的相加么，还有其他的特征工程么？问你还知道其他的特征工程的方法么？"></a>3.你们就只是进行了简单的相加么，还有其他的特征工程么？问你还知道其他的特征工程的方法么？</h4><h5 id="我说我看过之前kaggle-上的房屋比赛的特征工程，可以进行加减乘除，比如房屋面积除以人口数就是人均房屋面积，但我们这个比赛他不是没办法进行这样的特征工程。"><a href="#我说我看过之前kaggle-上的房屋比赛的特征工程，可以进行加减乘除，比如房屋面积除以人口数就是人均房屋面积，但我们这个比赛他不是没办法进行这样的特征工程。" class="headerlink" title="我说我看过之前kaggle 上的房屋比赛的特征工程，可以进行加减乘除，比如房屋面积除以人口数就是人均房屋面积，但我们这个比赛他不是没办法进行这样的特征工程。"></a>我说我看过之前kaggle 上的房屋比赛的特征工程，可以进行加减乘除，比如房屋面积除以人口数就是人均房屋面积，但我们这个比赛他不是没办法进行这样的特征工程。</h5><h4 id="4-那你们有创造交叉特征么？"><a href="#4-那你们有创造交叉特征么？" class="headerlink" title="4.那你们有创造交叉特征么？"></a>4.那你们有创造交叉特征么？</h4><h5 id="我说我们把手机型号和手机特征结合了起来，面试官说你那个不叫交叉特征，这两个本身就是连在一起的。。"><a href="#我说我们把手机型号和手机特征结合了起来，面试官说你那个不叫交叉特征，这两个本身就是连在一起的。。" class="headerlink" title="我说我们把手机型号和手机特征结合了起来，面试官说你那个不叫交叉特征，这两个本身就是连在一起的。。"></a>我说我们把手机型号和手机特征结合了起来，面试官说你那个不叫交叉特征，这两个本身就是连在一起的。。</h5><h4 id="5-你们有做模型的融合么？"><a href="#5-你们有做模型的融合么？" class="headerlink" title="5.你们有做模型的融合么？"></a>5.你们有做模型的融合么？</h4><h5 id="我说我们尝试用Lightgbm和xgboost进行了融合发现没有单个模型的效果好，面试官问你是怎么融合的，是进行的线性融合么，我说是的，他说你可以尝试一下其他的stacking方法。"><a href="#我说我们尝试用Lightgbm和xgboost进行了融合发现没有单个模型的效果好，面试官问你是怎么融合的，是进行的线性融合么，我说是的，他说你可以尝试一下其他的stacking方法。" class="headerlink" title="我说我们尝试用Lightgbm和xgboost进行了融合发现没有单个模型的效果好，面试官问你是怎么融合的，是进行的线性融合么，我说是的，他说你可以尝试一下其他的stacking方法。"></a>我说我们尝试用Lightgbm和xgboost进行了融合发现没有单个模型的效果好，面试官问你是怎么融合的，是进行的线性融合么，我说是的，他说你可以尝试一下其他的stacking方法。</h5><h4 id="6-你知道那个特征重要性是怎么得到的么？"><a href="#6-你知道那个特征重要性是怎么得到的么？" class="headerlink" title="6. 你知道那个特征重要性是怎么得到的么？"></a>6. 你知道那个特征重要性是怎么得到的么？</h4><h5 id="我说是根据得分函数来的，面试官让我推一下得分函数的公式。我就那笔粗略的写了一下，也不一定对。但我说了一下原理，弥补一下。"><a href="#我说是根据得分函数来的，面试官让我推一下得分函数的公式。我就那笔粗略的写了一下，也不一定对。但我说了一下原理，弥补一下。" class="headerlink" title="我说是根据得分函数来的，面试官让我推一下得分函数的公式。我就那笔粗略的写了一下，也不一定对。但我说了一下原理，弥补一下。"></a>我说是根据得分函数来的，面试官让我推一下得分函数的公式。我就那笔粗略的写了一下，也不一定对。但我说了一下原理，弥补一下。</h5><h4 id="7-你说一下FFM的原理吧。"><a href="#7-你说一下FFM的原理吧。" class="headerlink" title="7. 你说一下FFM的原理吧。"></a>7. 你说一下FFM的原理吧。</h4><h5 id="我就从FM说起，说了因子分解，又说到FFM的原理。"><a href="#我就从FM说起，说了因子分解，又说到FFM的原理。" class="headerlink" title="我就从FM说起，说了因子分解，又说到FFM的原理。"></a>我就从FM说起，说了因子分解，又说到FFM的原理。</h5><h4 id="8-你知道FFM比FM的改进在哪么？"><a href="#8-你知道FFM比FM的改进在哪么？" class="headerlink" title="8.你知道FFM比FM的改进在哪么？"></a>8.你知道FFM比FM的改进在哪么？</h4><h5 id="我说FFM可以把相同的特征归到一个field里面，隐向量不仅与特征有关，还与field有关。"><a href="#我说FFM可以把相同的特征归到一个field里面，隐向量不仅与特征有关，还与field有关。" class="headerlink" title="我说FFM可以把相同的特征归到一个field里面，隐向量不仅与特征有关，还与field有关。"></a>我说FFM可以把相同的特征归到一个field里面，隐向量不仅与特征有关，还与field有关。</h5><h4 id="9-你觉得FM到FFM是变复杂了还是变简单了？"><a href="#9-你觉得FM到FFM是变复杂了还是变简单了？" class="headerlink" title="9.你觉得FM到FFM是变复杂了还是变简单了？"></a>9.你觉得FM到FFM是变复杂了还是变简单了？</h4><h5 id="我想也不想就说变简单了，面试官说你确定，我说应该吧，毕竟计算的次数变少了，他说我建议你回去再看一下FFM的原理。ps-肯定是答错了"><a href="#我想也不想就说变简单了，面试官说你确定，我说应该吧，毕竟计算的次数变少了，他说我建议你回去再看一下FFM的原理。ps-肯定是答错了" class="headerlink" title="我想也不想就说变简单了，面试官说你确定，我说应该吧，毕竟计算的次数变少了，他说我建议你回去再看一下FFM的原理。ps:肯定是答错了"></a>我想也不想就说变简单了，面试官说你确定，我说应该吧，毕竟计算的次数变少了，他说我建议你回去再看一下FFM的原理。ps:肯定是答错了</h5><h4 id="10-面试写了两个有序数组，让我合并排序"><a href="#10-面试写了两个有序数组，让我合并排序" class="headerlink" title="10.面试写了两个有序数组，让我合并排序"></a>10.面试写了两个有序数组，让我合并排序</h4><h5 id="我没写出来，在面试官提示了之后说了一下思路，然后面试官又问了一个数据结构的算法，也没写出来"><a href="#我没写出来，在面试官提示了之后说了一下思路，然后面试官又问了一个数据结构的算法，也没写出来" class="headerlink" title="我没写出来，在面试官提示了之后说了一下思路，然后面试官又问了一个数据结构的算法，也没写出来"></a>我没写出来，在面试官提示了之后说了一下思路，然后面试官又问了一个数据结构的算法，也没写出来</h5><h4 id="后面就让我等着HR面了，因为我下班直接过去的，没吃晚饭，面试官还给我拿了零食吃，后来等到HR面的时候就问了一下我现在实习的情况和能实习多久，介绍了一下公司的情况，然后说了一下这边实习的情况（我就感觉有戏），让我等电话。第二天就给我打电话通知我过了，问什么时候能入职什么的。"><a href="#后面就让我等着HR面了，因为我下班直接过去的，没吃晚饭，面试官还给我拿了零食吃，后来等到HR面的时候就问了一下我现在实习的情况和能实习多久，介绍了一下公司的情况，然后说了一下这边实习的情况（我就感觉有戏），让我等电话。第二天就给我打电话通知我过了，问什么时候能入职什么的。" class="headerlink" title="后面就让我等着HR面了，因为我下班直接过去的，没吃晚饭，面试官还给我拿了零食吃，后来等到HR面的时候就问了一下我现在实习的情况和能实习多久，介绍了一下公司的情况，然后说了一下这边实习的情况（我就感觉有戏），让我等电话。第二天就给我打电话通知我过了，问什么时候能入职什么的。"></a>后面就让我等着HR面了，因为我下班直接过去的，没吃晚饭，面试官还给我拿了零食吃，后来等到HR面的时候就问了一下我现在实习的情况和能实习多久，介绍了一下公司的情况，然后说了一下这边实习的情况（我就感觉有戏），让我等电话。第二天就给我打电话通知我过了，问什么时候能入职什么的。</h4><h4 id="通过这次面试有一下感想："><a href="#通过这次面试有一下感想：" class="headerlink" title="通过这次面试有一下感想："></a>通过这次面试有一下感想：</h4><h4 id="1-项目里的算法要完全搞清楚，能推倒，面试官问的很细"><a href="#1-项目里的算法要完全搞清楚，能推倒，面试官问的很细" class="headerlink" title="1.项目里的算法要完全搞清楚，能推倒，面试官问的很细"></a>1.项目里的算法要完全搞清楚，能推倒，面试官问的很细</h4><h4 id="2-数据结构的算法面试必问，还要现场手写，自己这方面的饿coding能力还需要加强。"><a href="#2-数据结构的算法面试必问，还要现场手写，自己这方面的饿coding能力还需要加强。" class="headerlink" title="2.数据结构的算法面试必问，还要现场手写，自己这方面的饿coding能力还需要加强。"></a>2.数据结构的算法面试必问，还要现场手写，自己这方面的饿coding能力还需要加强。</h4><h4 id="接下来要做的："><a href="#接下来要做的：" class="headerlink" title="接下来要做的："></a>接下来要做的：</h4><h4 id="1-学习机器学习的算法，能实现手工推导"><a href="#1-学习机器学习的算法，能实现手工推导" class="headerlink" title="1.学习机器学习的算法，能实现手工推导"></a>1.学习机器学习的算法，能实现手工推导</h4><h4 id="2-刷Leetcode上的题目（最好能上传到github上）"><a href="#2-刷Leetcode上的题目（最好能上传到github上）" class="headerlink" title="2.刷Leetcode上的题目（最好能上传到github上）"></a>2.刷Leetcode上的题目（最好能上传到github上）</h4><h4 id="3-学习深度学习的知识，看吴恩达的视频"><a href="#3-学习深度学习的知识，看吴恩达的视频" class="headerlink" title="3.学习深度学习的知识，看吴恩达的视频"></a>3.学习深度学习的知识，看吴恩达的视频</h4><h5 id="希望能在秋招的时候拿到大厂的offer。"><a href="#希望能在秋招的时候拿到大厂的offer。" class="headerlink" title="希望能在秋招的时候拿到大厂的offer。"></a>希望能在秋招的时候拿到大厂的offer。</h5>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/21/我的第一篇博客/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yfchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yfchen's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/21/我的第一篇博客/" itemprop="url">我的第一篇博客</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-21T20:39:04+08:00">
                2018-01-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="原本自己使用过WordPress搭建过博客，但是需要有服务器，由于之前用的腾讯云服务器到期忘记续费了，想着利用Hexo-Github-io搭建自己的博客，教程网上一大堆，我就不再这里一一列举了，我用的是Mac搭建了，根据命令就建好了。"><a href="#原本自己使用过WordPress搭建过博客，但是需要有服务器，由于之前用的腾讯云服务器到期忘记续费了，想着利用Hexo-Github-io搭建自己的博客，教程网上一大堆，我就不再这里一一列举了，我用的是Mac搭建了，根据命令就建好了。" class="headerlink" title="原本自己使用过WordPress搭建过博客，但是需要有服务器，由于之前用的腾讯云服务器到期忘记续费了，想着利用Hexo+Github.io搭建自己的博客，教程网上一大堆，我就不再这里一一列举了，我用的是Mac搭建了，根据命令就建好了。"></a>原本自己使用过WordPress搭建过博客，但是需要有服务器，由于之前用的腾讯云服务器到期忘记续费了，想着利用Hexo+Github.io搭建自己的博客，教程网上一大堆，我就不再这里一一列举了，我用的是Mac搭建了，根据命令就建好了。</h3><h3 id="说一下自己想要搭建博客的目的"><a href="#说一下自己想要搭建博客的目的" class="headerlink" title="说一下自己想要搭建博客的目的"></a>说一下自己想要搭建博客的目的</h3><ol>
<li><h5 id="记录一些随笔感想"><a href="#记录一些随笔感想" class="headerlink" title="记录一些随笔感想"></a>记录一些随笔感想</h5></li>
<li><h5 id="写一些关于技术方面的博客，主要想记录自己学习机器学习和深度学习的一些心得，让自己加深印象。"><a href="#写一些关于技术方面的博客，主要想记录自己学习机器学习和深度学习的一些心得，让自己加深印象。" class="headerlink" title="写一些关于技术方面的博客，主要想记录自己学习机器学习和深度学习的一些心得，让自己加深印象。"></a>写一些关于技术方面的博客，主要想记录自己学习机器学习和深度学习的一些心得，让自己加深印象。</h5></li>
<li><h5 id="通过记录来让自己学习，我相信写下来才会让自己更加深刻，而且会锻炼自己的表达能力"><a href="#通过记录来让自己学习，我相信写下来才会让自己更加深刻，而且会锻炼自己的表达能力" class="headerlink" title="通过记录来让自己学习，我相信写下来才会让自己更加深刻，而且会锻炼自己的表达能力"></a>通过记录来让自己学习，我相信写下来才会让自己更加深刻，而且会锻炼自己的表达能力</h5><p>​</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">yfchen</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/chenyaofei-njupt" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:chenyaofei.njupt@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yfchen</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
